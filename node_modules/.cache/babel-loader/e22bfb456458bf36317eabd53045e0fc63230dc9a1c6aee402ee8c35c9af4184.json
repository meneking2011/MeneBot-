{"ast":null,"code":"import _objectSpread from\"/workspaces/MeneBot-/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncIterator from\"/workspaces/MeneBot-/node_modules/@babel/runtime/helpers/esm/asyncIterator.js\";import React,{useState,useEffect,useRef,useCallback}from\"react\";import{v4 as uuidv4}from'uuid';import{initializeApp}from'firebase/app';import{getAuth,signInAnonymously,onAuthStateChanged}from'firebase/auth';import{getFirestore,collection,query,onSnapshot,addDoc,orderBy,limit,serverTimestamp,setLogLevel,doc,deleteDoc,writeBatch,getDocs,setDoc}from'firebase/firestore';// --- ENVIRONMENT VARIABLE HANDLING ---\n// These variables are injected by the Canvas environment for Firebase setup.\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const appId=typeof __app_id!=='undefined'?__app_id:'default-app-id';const firebaseConfig=typeof __firebase_config!=='undefined'?JSON.parse(__firebase_config):null;const initialAuthToken=typeof __initial_auth_token!=='undefined'?__initial_auth_token:null;// The collection path for public chat data\nconst SESSIONS_COLLECTION_PATH=\"/artifacts/\".concat(appId,\"/users\");const MESSAGES_COLLECTION_PATH=(userId,sessionId)=>\"/artifacts/\".concat(appId,\"/users/\").concat(userId,\"/sessions/\").concat(sessionId,\"/messages\");// --- END ENVIRONMENT VARIABLE HANDLING ---\n// --- API Keys and Endpoints ---\nconst getApiKey=()=>{// Check for the secure, environment-provided key first, otherwise use a placeholder\nreturn typeof __api_key!=='undefined'?__api_key:'YOUR_GEMINI_API_KEY';};const MODEL_NAME='gemini-2.5-flash-preview-09-2025';const API_ENDPOINT=\"https://generativelanguage.googleapis.com/v1beta/models/\".concat(MODEL_NAME,\":generateContent?key=\");const TTS_MODEL_NAME='gemini-2.5-flash-preview-tts';const TTS_API_ENDPOINT=\"https://generativelanguage.googleapis.com/v1beta/models/\".concat(TTS_MODEL_NAME,\":generateContent?key=\");// ===============================================================\n// --- API and TTS/STT Helper Functions (Integrated) ---\n// ===============================================================\n/**\n * Creates an Async Iterator that handles the AI request and simulates a stream.\n */function askAIStream(inputText,chatHistory){let fullResponse=null;let chunks=[];let chunkIndex=0;const apiKey=getApiKey();const historyForAPI=chatHistory.map(msg=>({role:msg.sender==='user'?'user':'model',parts:[{text:msg.text}]}));// Manually implements the async iterator protocol\nreturn{async next(){try{// First call: make the REST API request\nif(fullResponse===null){var _data$candidates,_data$candidates$,_data$candidates$$con,_data$candidates$$con2,_data$candidates$$con3;const maxRetries=5;let attempt=0;let response;while(attempt<maxRetries){try{const payload={contents:[...historyForAPI,{role:'user',parts:[{text:inputText}]}],systemInstruction:{parts:[{text:\"You are Mene, a helpful and friendly AI assistant for users under 18. Keep your responses concise, age-appropriate, positive, and safe.\"}]}};response=await fetch(API_ENDPOINT+apiKey,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(response.ok){break;// Success!\n}else if(response.status===429||response.status>=500){attempt++;// Exponential backoff with jitter\nconst delay=Math.pow(2,attempt)*1000+Math.random()*1000;await new Promise(resolve=>setTimeout(resolve,delay));continue;}else{break;// Non-retriable error\n}}catch(fetchError){attempt++;if(attempt>=maxRetries)throw fetchError;const delay=Math.pow(2,attempt)*1000+Math.random()*1000;await new Promise(resolve=>setTimeout(resolve,delay));}}if(!response||!response.ok){var _response,_response2,_errorDetails$error;const errorDetails=response?await response.json():{error:{message:\"Network or unknown error.\"}};throw new Error(\"\".concat(((_response=response)===null||_response===void 0?void 0:_response.status)||'??',\" \").concat(((_response2=response)===null||_response2===void 0?void 0:_response2.statusText)||'Unknown Status',\": \").concat(((_errorDetails$error=errorDetails.error)===null||_errorDetails$error===void 0?void 0:_errorDetails$error.message)||'Unknown API Error'));}const data=await response.json();fullResponse=((_data$candidates=data.candidates)===null||_data$candidates===void 0?void 0:(_data$candidates$=_data$candidates[0])===null||_data$candidates$===void 0?void 0:(_data$candidates$$con=_data$candidates$.content)===null||_data$candidates$$con===void 0?void 0:(_data$candidates$$con2=_data$candidates$$con.parts)===null||_data$candidates$$con2===void 0?void 0:(_data$candidates$$con3=_data$candidates$$con2[0])===null||_data$candidates$$con3===void 0?void 0:_data$candidates$$con3.text)||\"No response received from AI.\";// Split the full response into smaller chunks (1-5 characters) for a much faster stream\nchunks=fullResponse.match(/[\\s\\S]{1,5}/g)||[fullResponse];}// Subsequent calls: Stream out the chunks one by one\nif(chunkIndex>=chunks.length){return{done:true,value:fullResponse};}// *** FIX: Reduced delay for much faster typing simulation (1ms) ***\nawait new Promise(r=>setTimeout(r,1));const chunk=chunks[chunkIndex++];return{value:chunk,done:false};}catch(error){console.error(\"Gemini API Error:\",error);return{value:\"ERROR: Failed to connect to AI. Details: \".concat(error.message),done:true};}},[Symbol.asyncIterator](){return this;}};}/**\n * Converts a base64 string to an ArrayBuffer.\n */const base64ToArrayBuffer=base64=>{const binaryString=atob(base64);const len=binaryString.length;const bytes=new Uint8Array(len);for(let i=0;i<len;i++){bytes[i]=binaryString.charCodeAt(i);}return bytes.buffer;};/**\n * Writes a string to a DataView at a specified offset.\n */const writeString=(view,offset,string)=>{for(let i=0;i<string.length;i++){view.setUint8(offset+i,string.charCodeAt(i));}};/**\n * Converts PCM (raw audio data) to a standard WAV format Blob.\n */const pcmToWav=(pcm16,sampleRate)=>{const numChannels=1;const numSamples=pcm16.length;const byteRate=sampleRate*numChannels*2;const blockAlign=numChannels*2;const buffer=new ArrayBuffer(44+pcm16.byteLength);const view=new DataView(buffer);// RIFF header\nwriteString(view,0,'RIFF');view.setUint32(4,36+pcm16.byteLength,true);writeString(view,8,'WAVE');// fmt sub-chunk\nwriteString(view,12,'fmt ');view.setUint32(16,16,true);view.setUint16(20,1,true);// Audio format 1 (PCM)\nview.setUint16(22,numChannels,true);view.setUint32(24,sampleRate,true);view.setUint32(28,byteRate,true);view.setUint16(32,blockAlign,true);view.setUint16(34,16,true);// Bits per sample\n// data sub-chunk\nwriteString(view,36,'data');view.setUint32(40,pcm16.byteLength,true);// PCM data\nconst pcmView=new Int16Array(buffer,44);pcmView.set(pcm16);return new Blob([buffer],{type:'audio/wav'});};/**\n * Makes the TTS API call and returns an Audio URL.\n */const ttsApiCall=async(text,setErrorMessage)=>{if(!text)return null;const apiKey=getApiKey();try{var _result$candidates,_result$candidates$,_result$candidates$$c,_result$candidates$$c2,_part$inlineData,_part$inlineData2;const payload={contents:[{parts:[{text:text}]}],generationConfig:{responseModalities:[\"AUDIO\"],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:\"Achird\"}}}}};const maxRetries=5;let attempt=0;let response;while(attempt<maxRetries){try{response=await fetch(TTS_API_ENDPOINT+apiKey,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(response.ok){break;}else if(response.status===429||response.status>=500){attempt++;const delay=Math.pow(2,attempt)*1000+Math.random()*1000;await new Promise(resolve=>setTimeout(resolve,delay));continue;}else{break;}}catch(fetchError){attempt++;if(attempt>=maxRetries)throw fetchError;const delay=Math.pow(2,attempt)*1000+Math.random()*1000;await new Promise(resolve=>setTimeout(resolve,delay));}}if(!response||!response.ok){var _response3;throw new Error(\"TTS API failed after \".concat(attempt,\" attempts with status \").concat(((_response3=response)===null||_response3===void 0?void 0:_response3.status)||'??'));}const result=await response.json();const part=result===null||result===void 0?void 0:(_result$candidates=result.candidates)===null||_result$candidates===void 0?void 0:(_result$candidates$=_result$candidates[0])===null||_result$candidates$===void 0?void 0:(_result$candidates$$c=_result$candidates$.content)===null||_result$candidates$$c===void 0?void 0:(_result$candidates$$c2=_result$candidates$$c.parts)===null||_result$candidates$$c2===void 0?void 0:_result$candidates$$c2[0];const audioData=part===null||part===void 0?void 0:(_part$inlineData=part.inlineData)===null||_part$inlineData===void 0?void 0:_part$inlineData.data;const mimeType=part===null||part===void 0?void 0:(_part$inlineData2=part.inlineData)===null||_part$inlineData2===void 0?void 0:_part$inlineData2.mimeType;if(audioData&&mimeType&&mimeType.startsWith(\"audio/L16\")){const rateMatch=mimeType.match(/rate=(\\d+)/);const sampleRate=rateMatch?parseInt(rateMatch[1],10):24000;const pcmData=base64ToArrayBuffer(audioData);const pcm16=new Int16Array(pcmData);const wavBlob=pcmToWav(pcm16,sampleRate);return URL.createObjectURL(wavBlob);}else{setErrorMessage(\"TTS Error: Could not generate valid audio data.\");return null;}}catch(error){console.error(\"TTS Fetch Error:\",error);setErrorMessage(\"TTS Generation failed: \".concat(error.message));return null;}};// ===============================================================\n// --- UI Components ---\n// ===============================================================\nconst Sidebar=/*#__PURE__*/React.memo(_ref=>{let{sessions,currentSessionId,switchSession,createNewSession,deleteSession,userId,isSidebarOpen,setIsSidebarOpen}=_ref;const displayUserId=userId?\"\".concat(userId.substring(0,8),\"...\"):\"N/A\";// Function to close sidebar on switch (mobile only)\nconst handleSwitch=sessionId=>{switchSession(sessionId);if(window.innerWidth<768){setIsSidebarOpen(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"w-full h-full md:w-64 bg-gray-50 border-r border-gray-200 p-4 flex flex-col transition-all duration-300\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-xl font-bold text-gray-800 mb-4 flex items-center justify-between\",children:[\"Conversations\",/*#__PURE__*/_jsx(\"button\",{onClick:createNewSession,className:\"p-2 bg-green-500 text-white rounded-full hover:bg-green-600 transition duration-150 shadow-md\",title:\"New Chat\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-5 w-5\",viewBox:\"0 0 20 20\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z\",clipRule:\"evenodd\"})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-y-auto space-y-2\",children:sessions.map(session=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-3 rounded-lg cursor-pointer transition duration-150 \".concat(session.id===currentSessionId?'bg-green-100 text-green-700 font-semibold':'bg-white text-gray-700 hover:bg-gray-100'),onClick:()=>handleSwitch(session.id),children:[/*#__PURE__*/_jsx(\"span\",{className:\"truncate flex-1\",children:session.name||\"New Chat\"}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();deleteSession(session.id);},className:\"text-red-500 p-1 hover:text-red-700 rounded-full transition duration-150 ml-2\",title:\"Delete Chat\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-4 w-4\",viewBox:\"0 0 20 20\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 100 2v6a1 1 0 100-2V8z\",clipRule:\"evenodd\"})})})]},session.id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 pt-4 border-t border-gray-200 text-sm text-gray-500\",children:[\"User ID: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-mono text-xs break-all\",children:displayUserId})]})]});});// ===============================================================\n// --- Main App Component ---\n// ===============================================================\nexport default function App(){// --- Firebase State ---\nconst[db,setDb]=useState(null);const[auth,setAuth]=useState(null);const[userId,setUserId]=useState(null);const[isAuthReady,setIsAuthReady]=useState(false);const[sessions,setSessions]=useState([]);const[currentSessionId,setCurrentSessionId]=useState(null);// --- Chat State ---\nconst[messages,setMessages]=useState([]);const[input,setInput]=useState(\"\");const[isTyping,setIsTyping]=useState(false);const[errorMessage,setErrorMessage]=useState(null);const messageEndRef=useRef(null);const[isSidebarOpen,setIsSidebarOpen]=useState(window.innerWidth>=768);// --- TTS/STT State ---\nconst[canSpeak,setCanSpeak]=useState(false);const[isListening,setIsListening]=useState(false);const[lastBotMessage,setLastBotMessage]=useState(null);const recognitionRef=useRef(null);// 1. Initialize Firebase and Authentication\nuseEffect(()=>{const checkWindowSize=()=>{setIsSidebarOpen(window.innerWidth>=768);};window.addEventListener('resize',checkWindowSize);try{if(!firebaseConfig){setErrorMessage(\"Configuration Error: Firebase configuration is missing.\");return()=>window.removeEventListener('resize',checkWindowSize);}const app=initializeApp(firebaseConfig);const firestore=getFirestore(app);const authentication=getAuth(app);setLogLevel('debug');setDb(firestore);setAuth(authentication);const authenticate=async()=>{if(initialAuthToken){await signInWithCustomToken(authentication,initialAuthToken);}else{await signInAnonymously(authentication);}};authenticate().catch(e=>{console.error(\"Firebase Auth Error during sign-in:\",e);setErrorMessage(\"Failed to authenticate with Firebase.\");});const unsubscribeAuth=onAuthStateChanged(authentication,user=>{const currentUserId=(user===null||user===void 0?void 0:user.uid)||crypto.randomUUID();setUserId(currentUserId);setIsAuthReady(true);});return()=>{unsubscribeAuth();window.removeEventListener('resize',checkWindowSize);};}catch(e){console.error(\"Firebase Init Error:\",e);setErrorMessage(\"Failed to initialize Firebase services. Check the console for details.\");return()=>window.removeEventListener('resize',checkWindowSize);}},[firebaseConfig,initialAuthToken]);// Dependencies for Firebase setup\n// 2. Setup Sessions Listener\nconst createSession=useCallback(async()=>{if(!db||!userId)return;try{const userSessionsRef=collection(db,SESSIONS_COLLECTION_PATH,userId,'sessions');const newDocRef=doc(userSessionsRef);const placeholderName=\"Chat \".concat(sessions.length+1);await setDoc(newDocRef,{name:placeholderName,createdAt:serverTimestamp()});setCurrentSessionId(newDocRef.id);if(window.innerWidth<768){setIsSidebarOpen(false);}}catch(e){console.error(\"Error creating new session:\",e);setErrorMessage(\"Failed to create a new session.\");}},[db,userId,sessions.length]);useEffect(()=>{if(!isAuthReady||!db||!userId)return;const userSessionsRef=collection(db,SESSIONS_COLLECTION_PATH,userId,'sessions');const q=query(userSessionsRef,orderBy('createdAt','desc'));const unsubscribe=onSnapshot(q,snapshot=>{const loadedSessions=snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setSessions(loadedSessions);if(loadedSessions.length===0){setTimeout(()=>createSession(),0);}else if(!currentSessionId||!loadedSessions.find(s=>s.id===currentSessionId)){setCurrentSessionId(loadedSessions[0].id);}},error=>{console.error(\"Firestore Sessions Error:\",error);setErrorMessage(\"Failed to fetch chat sessions. Check Firebase Security Rules.\");});return()=>unsubscribe();},[isAuthReady,db,userId,currentSessionId,createSession]);// 3. Setup Messages Listener (Current Session)\nuseEffect(()=>{if(!isAuthReady||!db||!userId||!currentSessionId){setMessages([]);return;}const messagesRef=collection(db,MESSAGES_COLLECTION_PATH(userId,currentSessionId));const q=query(messagesRef,orderBy('createdAt','asc'),limit(50));const unsubscribe=onSnapshot(q,snapshot=>{const loadedMessages=snapshot.docs.map(doc=>{var _data$createdAt;const data=doc.data();return{id:doc.id,sender:data.sender,text:data.text,createdAt:(_data$createdAt=data.createdAt)!==null&&_data$createdAt!==void 0&&_data$createdAt.toDate?data.createdAt.toDate():new Date()};});setMessages(loadedMessages);const lastBot=loadedMessages.slice().reverse().find(msg=>msg.sender==='bot');setLastBotMessage(lastBot);},error=>{console.error(\"Firestore Messages Error:\",error);setErrorMessage(\"Failed to fetch chat messages. Check Firebase Security Rules.\");});return()=>unsubscribe();},[isAuthReady,db,userId,currentSessionId]);// 4. Scroll to bottom on new messages/typing\nuseEffect(()=>{var _messageEndRef$curren;(_messageEndRef$curren=messageEndRef.current)===null||_messageEndRef$curren===void 0?void 0:_messageEndRef$curren.scrollIntoView({behavior:\"smooth\"});},[messages,isTyping]);// 5. Check for TTS/STT capability and setup STT\nuseEffect(()=>{if('speechSynthesis'in window&&'webkitSpeechRecognition'in window){setCanSpeak(true);}if('webkitSpeechRecognition'in window){const recognitionInstance=new window.webkitSpeechRecognition();recognitionInstance.continuous=false;recognitionInstance.interimResults=false;recognitionInstance.lang='en-US';recognitionInstance.onend=()=>setIsListening(false);recognitionInstance.onerror=event=>{console.error('Speech recognition error:',event.error);if(event.error!=='no-speech'&&event.error!=='not-allowed'){setErrorMessage(\"Speech recognition error: \".concat(event.error));}setIsListening(false);};recognitionRef.current=recognitionInstance;}return()=>{if(recognitionRef.current){recognitionRef.current.stop();recognitionRef.current=null;}};},[]);// --- Firebase Actions ---\nconst switchSession=useCallback(sessionId=>{setCurrentSessionId(sessionId);},[]);const deleteSession=async sessionId=>{if(!db||!userId)return;// Use custom modal UI instead of window.confirm\nif(!window.confirm(\"Are you sure you want to delete this chat session and all its messages?\")){return;}try{const sessionDocRef=doc(db,SESSIONS_COLLECTION_PATH,userId,'sessions',sessionId);const messagesRef=collection(db,MESSAGES_COLLECTION_PATH(userId,sessionId));const batch=writeBatch(db);const messageDocs=await getDocs(messagesRef);messageDocs.docs.forEach(msgDoc=>{batch.delete(msgDoc.ref);});batch.delete(sessionDocRef);await batch.commit();if(currentSessionId===sessionId){const remainingSessions=sessions.filter(s=>s.id!==sessionId);if(remainingSessions.length>0){setCurrentSessionId(remainingSessions[0].id);}else{setCurrentSessionId(null);setTimeout(()=>createSession(),100);}}}catch(e){console.error(\"Error deleting session:\",e);setErrorMessage(\"Failed to delete the chat session.\");}};// --- TTS/STT Handlers ---\nconst handleSpeak=useCallback(async text=>{if(!canSpeak||!text)return;setErrorMessage(null);const audioUrl=await ttsApiCall(text,setErrorMessage);if(audioUrl){const audio=new Audio(audioUrl);audio.play();}},[canSpeak]);const saveMessage=async(sender,text)=>{if(!db||!userId||!currentSessionId||!text)return;try{const messagesRef=collection(db,MESSAGES_COLLECTION_PATH(userId,currentSessionId));await addDoc(messagesRef,{sender:sender,text:text,createdAt:serverTimestamp()});}catch(e){console.error(\"Error saving message:\",e);setErrorMessage(\"Failed to save message to database.\");}};const handleSend=useCallback(async function(){let transcript=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;const textToSend=(transcript||input).trim();if(isTyping||!textToSend||!currentSessionId)return;setErrorMessage(null);setIsTyping(true);setInput(\"\");// Clear input immediately\n// 1. Save user message immediately (optimistically)\nawait saveMessage(\"user\",textToSend);// 2. Start AI streaming response\nlet accumulatedBotText=\"\";const historyForAI=messages.filter(msg=>msg.text).map(msg=>({sender:msg.sender,text:msg.text}));const stream=askAIStream(textToSend,historyForAI);// 3. Add a temporary message placeholder for streaming\nconst tempBotId=uuidv4();// Since we are using Firestore's onSnapshot, we rely on the Firestore listener \n// to update the messages array. We add a temporary message here to force\n// the scroll and show the typing indicator before Firestore catches up.\nsetMessages(prev=>[...prev,{id:tempBotId,sender:\"bot\",text:\"\"}]);var _iteratorAbruptCompletion=false;var _didIteratorError=false;var _iteratorError;try{for(var _iterator=_asyncIterator(stream),_step;_iteratorAbruptCompletion=!(_step=await _iterator.next()).done;_iteratorAbruptCompletion=false){const chunk=_step.value;{accumulatedBotText+=chunk;// Update the temporary message with accumulated text\nsetMessages(prev=>prev.map(msg=>msg.id===tempBotId?_objectSpread(_objectSpread({},msg),{},{text:accumulatedBotText}):msg));if(accumulatedBotText.includes(\"ERROR:\"))break;}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(_iteratorAbruptCompletion&&_iterator.return!=null){await _iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}setIsTyping(false);if(!accumulatedBotText.includes(\"ERROR:\")){var _currentSession$name;// 4. Update session name if it's the first message in the session\nconst currentSession=sessions.find(s=>s.id===currentSessionId);if(currentSession&&((_currentSession$name=currentSession.name)!==null&&_currentSession$name!==void 0&&_currentSession$name.startsWith('Chat ')||messages.length===0)){const sessionDocRef=doc(db,SESSIONS_COLLECTION_PATH,userId,'sessions',currentSessionId);const sessionName=textToSend.substring(0,30)+(textToSend.length>30?'...':'');// Use updateDoc for renaming\nawait updateDoc(sessionDocRef,{name:sessionName});}// 5. Save the final bot response (The snapshot listener will clean up the temp message)\nawait saveMessage(\"bot\",accumulatedBotText);}else{// Remove the temporary message if it resulted in an error\nsetMessages(prev=>prev.filter(msg=>msg.id!==tempBotId));}},[input,isTyping,currentSessionId,db,userId,messages,sessions]);const startListening=useCallback(()=>{if(isTyping||!recognitionRef.current)return;setErrorMessage(null);const recognitionInstance=recognitionRef.current;recognitionInstance.onresult=event=>{const transcript=event.results[0][0].transcript;setInput(transcript);recognitionInstance.stop();// Send the message once listening stops\nhandleSend(transcript);};try{recognitionInstance.start();setIsListening(true);}catch(e){if(e.name!=='InvalidStateError'){console.error(\"STT Start Error:\",e);setErrorMessage(\"Speech recognition failed to start. Check microphone permissions.\");setIsListening(false);}}},[isTyping,handleSend,setInput,setIsListening]);// --- Render Logic ---\nif(!isAuthReady){return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center min-h-screen text-gray-600 bg-gray-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 bg-white rounded-xl shadow-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mr-3 inline-block\"}),/*#__PURE__*/_jsx(\"p\",{className:\"inline-block\",children:\"Loading application and authenticating...\"})]})});}// Header component\nconst Header=()=>{var _sessions$find;return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-green-600 text-white shadow-md flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"md:hidden p-1 rounded-md hover:bg-green-700 transition\",onClick:()=>setIsSidebarOpen(!isSidebarOpen),title:\"Toggle Sidebar\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-6 w-6\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M4 6h16M4 12h16m-7 6h7\"})})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl font-bold flex-1 text-center md:text-left\",children:\"Mene AI Chatbot\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"hidden md:block text-sm opacity-80 bg-green-700 px-3 py-1 rounded-full\",children:[\"Session: \",((_sessions$find=sessions.find(s=>s.id===currentSessionId))===null||_sessions$find===void 0?void 0:_sessions$find.name)||\"New Chat\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"hidden md:block text-xs font-mono opacity-60 ml-4\",children:[\"App ID: \",appId.substring(0,8),\"...\"]})]});};// Main Chat Content\nconst chatContent=/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 flex flex-col min-w-0 bg-white\",children:[/*#__PURE__*/_jsx(Header,{}),errorMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-red-100 text-red-700 text-sm text-center font-medium border-l-4 border-red-500\",children:errorMessage}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 p-4 space-y-4 overflow-y-auto custom-scrollbar\",children:[messages.map(msg=>/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(msg.sender===\"user\"?\"justify-end\":\"justify-start\"),children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-xs md:max-w-md lg:max-w-lg p-3 rounded-xl shadow-md text-sm \".concat(msg.sender===\"user\"?\"bg-blue-500 text-white rounded-br-none\":\"bg-gray-200 text-gray-800 rounded-tl-none\"),onClick:msg.sender===\"bot\"&&canSpeak?()=>handleSpeak(msg.text):null,style:msg.sender===\"bot\"&&canSpeak?{cursor:'pointer'}:{},title:msg.sender===\"bot\"&&canSpeak?\"Click to hear this message\":null,children:msg.text})},msg.id)),isTyping&&/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-start\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-xs p-3 rounded-xl bg-gray-100 text-gray-500 italic text-sm shadow-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"dot-pulse mr-2\"}),\" Mene is generating...\"]})}),/*#__PURE__*/_jsx(\"div\",{ref:messageEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 border-t border-gray-200 flex items-center space-x-2 bg-gray-50\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"p-3 rounded-full transition duration-150 shadow-md \".concat(isListening?'bg-red-500 text-white animate-pulse':'bg-gray-300 text-gray-700 hover:bg-gray-400'),onClick:startListening,disabled:isTyping||!canSpeak,title:isListening?\"Listening...\":\"Start voice input (STT)\",children:/*#__PURE__*/_jsxs(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-5 w-5\",viewBox:\"0 0 20 20\",fill:\"currentColor\",children:[/*#__PURE__*/_jsx(\"path\",{d:\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4z\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M5.5 9.5a.5.5 0 011 0v4a.5.5 0 01-1 0v-4zM13.5 9.5a.5.5 0 011 0v4a.5.5 0 01-1 0v-4z\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M10 18a.75.75 0 01-.75-.75V15a.75.75 0 011.5 0v2.25A.75.75 0 0110 18zm6.5-6.5a.5.5 0 01-1 0v-4a.5.5 0 011 0v4zM3.5 11.5a.5.5 0 011 0v-4a.5.5 0 01-1 0v4z\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M5 9.75a.75.75 0 01.75-.75h8.5a.75.75 0 010 1.5H5.75A.75.75 0 015 9.75z\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M15 11a1 1 0 011 1v2a4 4 0 01-8 0v-2a1 1 0 011-1h6z\"})]})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:input,onChange:e=>setInput(e.target.value)// *** FIX: Added onKeyDown handler for Enter to send ***\n,onKeyDown:e=>e.key===\"Enter\"&&handleSend(),placeholder:\"Ask Mene anything...\",disabled:isTyping,className:\"flex-1 p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150\"}),/*#__PURE__*/_jsx(\"button\",{className:\"p-3 rounded-full transition duration-150 shadow-md \".concat(canSpeak&&!isTyping&&lastBotMessage?'bg-green-500 text-white hover:bg-green-600':'bg-gray-300 text-gray-500 cursor-not-allowed'),onClick:()=>handleSpeak(lastBotMessage===null||lastBotMessage===void 0?void 0:lastBotMessage.text),disabled:isTyping||!canSpeak||!lastBotMessage,title:\"Read last bot message aloud (TTS)\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-5 w-5\",viewBox:\"0 0 20 20\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M9.383 3.003c.125-.466.52-.803.955-.803h.305c.435 0 .83.337.955.803l.36 1.353a1.5 1.5 0 001.037.989l.254.053c1.685.356 2.5 1.776 2.5 3.328v2.96c0 1.552-.815 2.972-2.5 3.328l-.254.053a1.5 1.5 0 00-1.037.989l-.36 1.353c-.125.466-.52.803-.955.803h-.305c-.435 0-.83-.337-.955.803l-.36-1.353a1.5 1.5 0 00-1.037-.989l-.254-.053c-1.685-.356-2.5-1.776-2.5-3.328v-2.96c0-1.552.815-2.972 2.5-3.328l.254-.053a1.5 1.5 0 001.037-.989l.36-1.353zM10 7a1 1 0 100 2 1 1 0 000-2zm0 4a1 1 0 100 2 1 1 0 000-2z\"})})}),/*#__PURE__*/_jsx(\"button\",{className:\"p-3 rounded-full transition duration-150 shadow-md \".concat(isTyping||!input.trim()?'bg-gray-300 text-gray-500 cursor-not-allowed':'bg-green-500 text-white hover:bg-green-600'),onClick:()=>handleSend(),disabled:isTyping||!input.trim(),title:\"Send Message\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-5 w-5\",viewBox:\"0 0 20 20\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l4.47-1.405 6.447 3.376a1 1 0 00.999 0l6.447-3.376 4.47 1.405a1 1 0 001.169-1.409l-7-14z\"})})})]})]});// Final Application Layout (Desktop/Mobile Responsive)\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-0 md:p-4 font-inter\",children:[/*#__PURE__*/_jsx(\"script\",{src:\"https://cdn.tailwindcss.com\"}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n                    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\\n                    body { font-family: 'Inter', sans-serif; }\\n                    .custom-scrollbar::-webkit-scrollbar { width: 8px; }\\n                    .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }\\n                    .custom-scrollbar::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }\\n                    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #999; }\\n\\n                    /* Typing Indicator (Dot Pulse) */\\n                    .dot-pulse {\\n                        position: relative;\\n                        left: -9999px;\\n                        width: 5px;\\n                        height: 5px;\\n                        border-radius: 50%;\\n                        background-color: #9ca3af; /* gray-400 */\\n                        color: #9ca3af;\\n                        box-shadow: 9999px 0 0 -5px;\\n                        animation: dotPulse 1.5s infinite linear;\\n                        animation-delay: 0.25s;\\n                        display: inline-block;\\n                        margin-right: 8px;\\n                    }\\n                    .dot-pulse::before, .dot-pulse::after {\\n                        content: '';\\n                        display: inline-block;\\n                        position: absolute;\\n                        top: 0;\\n                        width: 5px;\\n                        height: 5px;\\n                        border-radius: 50%;\\n                        background-color: #9ca3af;\\n                        color: #9ca3af;\\n                    }\\n                    .dot-pulse::before {\\n                        box-shadow: 9999px 0 0 -5px;\\n                        animation: dotPulseBefore 1.5s infinite linear;\\n                        animation-delay: 0s;\\n                        left: -15px;\\n                    }\\n                    .dot-pulse::after {\\n                        box-shadow: 9999px 0 0 -5px;\\n                        animation: dotPulseAfter 1.5s infinite linear;\\n                        animation-delay: 0.5s;\\n                        left: 15px;\\n                    }\\n\\n                    @keyframes dotPulseBefore {\\n                        0% { box-shadow: 9999px 0 0 -5px; }\\n                        30% { box-shadow: 9999px 0 0 2px; }\\n                        60%, 100% { box-shadow: 9999px 0 0 -5px; }\\n                    }\\n                    @keyframes dotPulse {\\n                        0% { box-shadow: 9999px 0 0 -5px; }\\n                        30% { box-shadow: 9999px 0 0 2px; }\\n                        60%, 100% { box-shadow: 9999px 0 0 -5px; }\\n                    }\\n                    @keyframes dotPulseAfter {\\n                        0% { box-shadow: 9999px 0 0 -5px; }\\n                        30% { box-shadow: 9999px 0 0 2px; }\\n                        60%, 100% { box-shadow: 9999px 0 0 -5px; }\\n                    }\\n\\n                    /* Sidebar Positioning */\\n                    .sidebar-container {\\n                        position: fixed;\\n                        top: 0;\\n                        left: 0;\\n                        height: 100vh;\\n                        z-index: 40;\\n                        transition: transform 0.3s ease-in-out;\\n                        width: 16rem; \\n                    }\\n\\n                    @media (min-width: 768px) {\\n                        .sidebar-container {\\n                            position: static;\\n                            height: auto;\\n                            transform: translateX(0) !important;\\n                            width: 16rem; \\n                            flex-shrink: 0; /* Prevents it from shrinking */\\n                        }\\n                    }\\n                \"}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full h-screen md:w-full md:max-w-6xl md:h-[90vh] flex bg-white md:rounded-xl shadow-2xl overflow-hidden transition-all duration-300\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sidebar-container \".concat(isSidebarOpen?'translate-x-0':'-translate-x-full',\" md:translate-x-0\"),children:/*#__PURE__*/_jsx(Sidebar,{sessions:sessions,currentSessionId:currentSessionId,switchSession:switchSession,createNewSession:createSession,deleteSession:deleteSession,userId:userId,isSidebarOpen:isSidebarOpen,setIsSidebarOpen:setIsSidebarOpen})}),isSidebarOpen&&window.innerWidth<768&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black opacity-50 md:hidden z-30\",onClick:()=>setIsSidebarOpen(false)}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 flex flex-col min-w-0 z-10\",children:chatContent})]})]});}","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","v4","uuidv4","initializeApp","getAuth","signInAnonymously","onAuthStateChanged","getFirestore","collection","query","onSnapshot","addDoc","orderBy","limit","serverTimestamp","setLogLevel","doc","deleteDoc","writeBatch","getDocs","setDoc","jsx","_jsx","jsxs","_jsxs","appId","__app_id","firebaseConfig","__firebase_config","JSON","parse","initialAuthToken","__initial_auth_token","SESSIONS_COLLECTION_PATH","concat","MESSAGES_COLLECTION_PATH","userId","sessionId","getApiKey","__api_key","MODEL_NAME","API_ENDPOINT","TTS_MODEL_NAME","TTS_API_ENDPOINT","askAIStream","inputText","chatHistory","fullResponse","chunks","chunkIndex","apiKey","historyForAPI","map","msg","role","sender","parts","text","next","_data$candidates","_data$candidates$","_data$candidates$$con","_data$candidates$$con2","_data$candidates$$con3","maxRetries","attempt","response","payload","contents","systemInstruction","fetch","method","headers","body","stringify","ok","status","delay","Math","pow","random","Promise","resolve","setTimeout","fetchError","_response","_response2","_errorDetails$error","errorDetails","json","error","message","Error","statusText","data","candidates","content","match","length","done","value","r","chunk","console","Symbol","asyncIterator","base64ToArrayBuffer","base64","binaryString","atob","len","bytes","Uint8Array","i","charCodeAt","buffer","writeString","view","offset","string","setUint8","pcmToWav","pcm16","sampleRate","numChannels","numSamples","byteRate","blockAlign","ArrayBuffer","byteLength","DataView","setUint32","setUint16","pcmView","Int16Array","set","Blob","type","ttsApiCall","setErrorMessage","_result$candidates","_result$candidates$","_result$candidates$$c","_result$candidates$$c2","_part$inlineData","_part$inlineData2","generationConfig","responseModalities","speechConfig","voiceConfig","prebuiltVoiceConfig","voiceName","_response3","result","part","audioData","inlineData","mimeType","startsWith","rateMatch","parseInt","pcmData","wavBlob","URL","createObjectURL","Sidebar","memo","_ref","sessions","currentSessionId","switchSession","createNewSession","deleteSession","isSidebarOpen","setIsSidebarOpen","displayUserId","substring","handleSwitch","window","innerWidth","className","children","onClick","title","xmlns","viewBox","fill","fillRule","d","clipRule","session","id","name","e","stopPropagation","App","db","setDb","auth","setAuth","setUserId","isAuthReady","setIsAuthReady","setSessions","setCurrentSessionId","messages","setMessages","input","setInput","isTyping","setIsTyping","errorMessage","messageEndRef","canSpeak","setCanSpeak","isListening","setIsListening","lastBotMessage","setLastBotMessage","recognitionRef","checkWindowSize","addEventListener","removeEventListener","app","firestore","authentication","authenticate","signInWithCustomToken","catch","unsubscribeAuth","user","currentUserId","uid","crypto","randomUUID","createSession","userSessionsRef","newDocRef","placeholderName","createdAt","q","unsubscribe","snapshot","loadedSessions","docs","_objectSpread","find","s","messagesRef","loadedMessages","_data$createdAt","toDate","Date","lastBot","slice","reverse","_messageEndRef$curren","current","scrollIntoView","behavior","recognitionInstance","webkitSpeechRecognition","continuous","interimResults","lang","onend","onerror","event","stop","confirm","sessionDocRef","batch","messageDocs","forEach","msgDoc","delete","ref","commit","remainingSessions","filter","handleSpeak","audioUrl","audio","Audio","play","saveMessage","handleSend","transcript","arguments","undefined","textToSend","trim","accumulatedBotText","historyForAI","stream","tempBotId","prev","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_asyncIterator","_step","includes","err","return","_currentSession$name","currentSession","sessionName","updateDoc","startListening","onresult","results","start","Header","_sessions$find","stroke","strokeLinecap","strokeLinejoin","strokeWidth","chatContent","style","cursor","disabled","onChange","target","onKeyDown","key","placeholder","src"],"sources":["/workspaces/MeneBot-/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport { v4 as uuidv4 } from 'uuid';\nimport { \n    initializeApp \n} from 'firebase/app';\nimport { \n    getAuth, \n    signInAnonymously, \n    onAuthStateChanged,\n} from 'firebase/auth';\nimport { \n    getFirestore, \n    collection, \n    query, \n    onSnapshot, \n    addDoc, \n    orderBy,\n    limit,\n    serverTimestamp,\n    setLogLevel,\n    doc,\n    deleteDoc,\n    writeBatch,\n    getDocs,\n    setDoc\n} from 'firebase/firestore';\n\n\n// --- ENVIRONMENT VARIABLE HANDLING ---\n// These variables are injected by the Canvas environment for Firebase setup.\nconst appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\nconst firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\nconst initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\n\n// The collection path for public chat data\nconst SESSIONS_COLLECTION_PATH = `/artifacts/${appId}/users`;\nconst MESSAGES_COLLECTION_PATH = (userId, sessionId) => \n    `/artifacts/${appId}/users/${userId}/sessions/${sessionId}/messages`;\n// --- END ENVIRONMENT VARIABLE HANDLING ---\n\n// --- API Keys and Endpoints ---\nconst getApiKey = () => {\n    // Check for the secure, environment-provided key first, otherwise use a placeholder\n    return typeof __api_key !== 'undefined' ? __api_key : 'YOUR_GEMINI_API_KEY'; \n};\n\nconst MODEL_NAME = 'gemini-2.5-flash-preview-09-2025';\nconst API_ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=`;\nconst TTS_MODEL_NAME = 'gemini-2.5-flash-preview-tts';\nconst TTS_API_ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/${TTS_MODEL_NAME}:generateContent?key=`;\n\n\n// ===============================================================\n// --- API and TTS/STT Helper Functions (Integrated) ---\n// ===============================================================\n\n/**\n * Creates an Async Iterator that handles the AI request and simulates a stream.\n */\nfunction askAIStream(inputText, chatHistory) {\n    let fullResponse = null;\n    let chunks = [];\n    let chunkIndex = 0;\n    const apiKey = getApiKey();\n\n    const historyForAPI = chatHistory.map(msg => ({\n        role: msg.sender === 'user' ? 'user' : 'model',\n        parts: [{ text: msg.text }],\n    }));\n\n    // Manually implements the async iterator protocol\n    return {\n        async next() {\n            try {\n                // First call: make the REST API request\n                if (fullResponse === null) {\n                    const maxRetries = 5;\n                    let attempt = 0;\n                    let response;\n                    \n                    while (attempt < maxRetries) {\n                        try {\n                            const payload = {\n                                contents: [...historyForAPI, { role: 'user', parts: [{ text: inputText }] }],\n                                systemInstruction: { parts: [{ text: \"You are Mene, a helpful and friendly AI assistant for users under 18. Keep your responses concise, age-appropriate, positive, and safe.\" }] },\n                            };\n        \n                            response = await fetch(API_ENDPOINT + apiKey, {\n                                method: 'POST',\n                                headers: { 'Content-Type': 'application/json' },\n                                body: JSON.stringify(payload)\n                            });\n        \n                            if (response.ok) {\n                                break; // Success!\n                            } else if (response.status === 429 || response.status >= 500) {\n                                attempt++;\n                                // Exponential backoff with jitter\n                                const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;\n                                await new Promise(resolve => setTimeout(resolve, delay));\n                                continue; \n                            } else {\n                                break; // Non-retriable error\n                            }\n                        } catch (fetchError) {\n                            attempt++;\n                            if (attempt >= maxRetries) throw fetchError;\n                            const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;\n                            await new Promise(resolve => setTimeout(resolve, delay));\n                        }\n                    }\n                    \n                    if (!response || !response.ok) {\n                        const errorDetails = response ? await response.json() : { error: { message: \"Network or unknown error.\" } };\n                        throw new Error(`${response?.status || '??'} ${response?.statusText || 'Unknown Status'}: ${errorDetails.error?.message || 'Unknown API Error'}`); \n                    }\n                    \n                    const data = await response.json();\n                    \n                    fullResponse = data.candidates?.[0]?.content?.parts?.[0]?.text || \"No response received from AI.\";\n                    \n                    // Split the full response into smaller chunks (1-5 characters) for a much faster stream\n                    chunks = fullResponse.match(/[\\s\\S]{1,5}/g) || [fullResponse]; \n                }\n\n                // Subsequent calls: Stream out the chunks one by one\n                if (chunkIndex >= chunks.length) {\n                    return { done: true, value: fullResponse }; \n                }\n\n                // *** FIX: Reduced delay for much faster typing simulation (1ms) ***\n                await new Promise((r) => setTimeout(r, 1)); \n\n                const chunk = chunks[chunkIndex++];\n                return { value: chunk, done: false };\n\n            } catch (error) {\n                console.error(\"Gemini API Error:\", error);\n                return { value: `ERROR: Failed to connect to AI. Details: ${error.message}`, done: true };\n            }\n        },\n        [Symbol.asyncIterator]() {\n            return this;\n        }\n    };\n}\n\n\n/**\n * Converts a base64 string to an ArrayBuffer.\n */\nconst base64ToArrayBuffer = (base64) => {\n    const binaryString = atob(base64);\n    const len = binaryString.length;\n    const bytes = new Uint8Array(len);\n    for (let i = 0; i < len; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n    }\n    return bytes.buffer;\n};\n\n/**\n * Writes a string to a DataView at a specified offset.\n */\nconst writeString = (view, offset, string) => {\n    for (let i = 0; i < string.length; i++) {\n        view.setUint8(offset + i, string.charCodeAt(i));\n    }\n};\n\n/**\n * Converts PCM (raw audio data) to a standard WAV format Blob.\n */\nconst pcmToWav = (pcm16, sampleRate) => {\n    const numChannels = 1;\n    const numSamples = pcm16.length;\n    const byteRate = sampleRate * numChannels * 2; \n    const blockAlign = numChannels * 2;\n\n    const buffer = new ArrayBuffer(44 + pcm16.byteLength);\n    const view = new DataView(buffer);\n\n    // RIFF header\n    writeString(view, 0, 'RIFF');\n    view.setUint32(4, 36 + pcm16.byteLength, true);\n    writeString(view, 8, 'WAVE');\n    \n    // fmt sub-chunk\n    writeString(view, 12, 'fmt ');\n    view.setUint32(16, 16, true);\n    view.setUint16(20, 1, true); // Audio format 1 (PCM)\n    view.setUint16(22, numChannels, true);\n    view.setUint32(24, sampleRate, true);\n    view.setUint32(28, byteRate, true);\n    view.setUint16(32, blockAlign, true);\n    view.setUint16(34, 16, true); // Bits per sample\n    \n    // data sub-chunk\n    writeString(view, 36, 'data');\n    view.setUint32(40, pcm16.byteLength, true);\n\n    // PCM data\n    const pcmView = new Int16Array(buffer, 44);\n    pcmView.set(pcm16);\n\n    return new Blob([buffer], { type: 'audio/wav' });\n};\n\n/**\n * Makes the TTS API call and returns an Audio URL.\n */\nconst ttsApiCall = async (text, setErrorMessage) => {\n    if (!text) return null;\n    const apiKey = getApiKey();\n\n    try {\n        const payload = {\n            contents: [{ parts: [{ text: text }] }],\n            generationConfig: {\n                responseModalities: [\"AUDIO\"],\n                speechConfig: {\n                    voiceConfig: {\n                        prebuiltVoiceConfig: { voiceName: \"Achird\" } \n                    }\n                }\n            }\n        };\n\n        const maxRetries = 5;\n        let attempt = 0;\n        let response;\n        \n        while (attempt < maxRetries) {\n            try {\n                response = await fetch(TTS_API_ENDPOINT + apiKey, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(payload)\n                });\n\n                if (response.ok) {\n                    break; \n                } else if (response.status === 429 || response.status >= 500) {\n                    attempt++;\n                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;\n                    await new Promise(resolve => setTimeout(resolve, delay));\n                    continue; \n                } else {\n                    break; \n                }\n            } catch (fetchError) {\n                attempt++;\n                if (attempt >= maxRetries) throw fetchError;\n                const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;\n                await new Promise(resolve => setTimeout(resolve, delay));\n            }\n        }\n\n        if (!response || !response.ok) {\n            throw new Error(`TTS API failed after ${attempt} attempts with status ${response?.status || '??'}`);\n        }\n\n        const result = await response.json();\n        const part = result?.candidates?.[0]?.content?.parts?.[0];\n        const audioData = part?.inlineData?.data;\n        const mimeType = part?.inlineData?.mimeType;\n\n        if (audioData && mimeType && mimeType.startsWith(\"audio/L16\")) {\n            const rateMatch = mimeType.match(/rate=(\\d+)/);\n            const sampleRate = rateMatch ? parseInt(rateMatch[1], 10) : 24000; \n\n            const pcmData = base64ToArrayBuffer(audioData);\n            const pcm16 = new Int16Array(pcmData);\n            const wavBlob = pcmToWav(pcm16, sampleRate);\n            return URL.createObjectURL(wavBlob);\n        } else {\n            setErrorMessage(\"TTS Error: Could not generate valid audio data.\");\n            return null;\n        }\n\n    } catch (error) {\n        console.error(\"TTS Fetch Error:\", error);\n        setErrorMessage(`TTS Generation failed: ${error.message}`);\n        return null;\n    }\n};\n\n\n// ===============================================================\n// --- UI Components ---\n// ===============================================================\n\nconst Sidebar = React.memo(({ sessions, currentSessionId, switchSession, createNewSession, deleteSession, userId, isSidebarOpen, setIsSidebarOpen }) => {\n    const displayUserId = userId ? `${userId.substring(0, 8)}...` : \"N/A\";\n    \n    // Function to close sidebar on switch (mobile only)\n    const handleSwitch = (sessionId) => {\n        switchSession(sessionId);\n        if (window.innerWidth < 768) {\n            setIsSidebarOpen(false); \n        }\n    };\n\n    return (\n        <div className=\"w-full h-full md:w-64 bg-gray-50 border-r border-gray-200 p-4 flex flex-col transition-all duration-300\">\n            <h2 className=\"text-xl font-bold text-gray-800 mb-4 flex items-center justify-between\">\n                Conversations\n                <button\n                    onClick={createNewSession}\n                    className=\"p-2 bg-green-500 text-white rounded-full hover:bg-green-600 transition duration-150 shadow-md\"\n                    title=\"New Chat\"\n                >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path fillRule=\"evenodd\" d=\"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z\" clipRule=\"evenodd\" />\n                    </svg>\n                </button>\n            </h2>\n\n            <div className=\"flex-1 overflow-y-auto space-y-2\">\n                {sessions.map((session) => (\n                    <div\n                        key={session.id}\n                        className={`flex items-center justify-between p-3 rounded-lg cursor-pointer transition duration-150 ${session.id === currentSessionId ? 'bg-green-100 text-green-700 font-semibold' : 'bg-white text-gray-700 hover:bg-gray-100'}`}\n                        onClick={() => handleSwitch(session.id)}\n                    >\n                        <span className=\"truncate flex-1\">{session.name || \"New Chat\"}</span>\n                        <button\n                            onClick={(e) => { e.stopPropagation(); deleteSession(session.id); }}\n                            className=\"text-red-500 p-1 hover:text-red-700 rounded-full transition duration-150 ml-2\"\n                            title=\"Delete Chat\"\n                        >\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                                <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 100 2v6a1 1 0 100-2V8z\" clipRule=\"evenodd\" />\n                            </svg>\n                        </button>\n                    </div>\n                ))}\n            </div>\n            <div className=\"mt-4 pt-4 border-t border-gray-200 text-sm text-gray-500\">\n                User ID: <span className=\"font-mono text-xs break-all\">{displayUserId}</span>\n            </div>\n        </div>\n    );\n});\n\n\n// ===============================================================\n// --- Main App Component ---\n// ===============================================================\n\nexport default function App() {\n    // --- Firebase State ---\n    const [db, setDb] = useState(null);\n    const [auth, setAuth] = useState(null);\n    const [userId, setUserId] = useState(null);\n    const [isAuthReady, setIsAuthReady] = useState(false);\n    const [sessions, setSessions] = useState([]);\n    const [currentSessionId, setCurrentSessionId] = useState(null);\n\n    // --- Chat State ---\n    const [messages, setMessages] = useState([]);\n    const [input, setInput] = useState(\"\");\n    const [isTyping, setIsTyping] = useState(false);\n    const [errorMessage, setErrorMessage] = useState(null);\n    const messageEndRef = useRef(null);\n    const [isSidebarOpen, setIsSidebarOpen] = useState(window.innerWidth >= 768); \n\n    // --- TTS/STT State ---\n    const [canSpeak, setCanSpeak] = useState(false);\n    const [isListening, setIsListening] = useState(false); \n    const [lastBotMessage, setLastBotMessage] = useState(null);\n    const recognitionRef = useRef(null); \n\n\n    // 1. Initialize Firebase and Authentication\n    useEffect(() => {\n        const checkWindowSize = () => {\n            setIsSidebarOpen(window.innerWidth >= 768);\n        };\n\n        window.addEventListener('resize', checkWindowSize);\n\n        try {\n            if (!firebaseConfig) {\n                 setErrorMessage(\"Configuration Error: Firebase configuration is missing.\");\n                 return () => window.removeEventListener('resize', checkWindowSize);\n            }\n\n            const app = initializeApp(firebaseConfig);\n            const firestore = getFirestore(app);\n            const authentication = getAuth(app);\n\n            setLogLevel('debug'); \n            setDb(firestore);\n            setAuth(authentication);\n\n            const authenticate = async () => {\n                if (initialAuthToken) {\n                    await signInWithCustomToken(authentication, initialAuthToken);\n                } else {\n                    await signInAnonymously(authentication);\n                }\n            };\n            \n            authenticate().catch((e) => {\n                console.error(\"Firebase Auth Error during sign-in:\", e);\n                setErrorMessage(\"Failed to authenticate with Firebase.\");\n            });\n\n            const unsubscribeAuth = onAuthStateChanged(authentication, (user) => {\n                const currentUserId = user?.uid || crypto.randomUUID();\n                setUserId(currentUserId);\n                setIsAuthReady(true);\n            });\n\n            return () => {\n                unsubscribeAuth();\n                window.removeEventListener('resize', checkWindowSize);\n            }\n        } catch (e) {\n            console.error(\"Firebase Init Error:\", e);\n            setErrorMessage(\"Failed to initialize Firebase services. Check the console for details.\");\n            return () => window.removeEventListener('resize', checkWindowSize);\n        }\n    }, [firebaseConfig, initialAuthToken]); // Dependencies for Firebase setup\n\n    \n    // 2. Setup Sessions Listener\n    const createSession = useCallback(async () => {\n        if (!db || !userId) return;\n\n        try {\n            const userSessionsRef = collection(db, SESSIONS_COLLECTION_PATH, userId, 'sessions');\n            const newDocRef = doc(userSessionsRef);\n            \n            const placeholderName = `Chat ${sessions.length + 1}`; \n\n            await setDoc(newDocRef, {\n                name: placeholderName,\n                createdAt: serverTimestamp(),\n            });\n\n            setCurrentSessionId(newDocRef.id);\n            if (window.innerWidth < 768) {\n                setIsSidebarOpen(false); \n            }\n        } catch (e) {\n            console.error(\"Error creating new session:\", e);\n            setErrorMessage(\"Failed to create a new session.\");\n        }\n    }, [db, userId, sessions.length]);\n\n    useEffect(() => {\n        if (!isAuthReady || !db || !userId) return;\n\n        const userSessionsRef = collection(db, SESSIONS_COLLECTION_PATH, userId, 'sessions');\n        const q = query(userSessionsRef, orderBy('createdAt', 'desc'));\n\n        const unsubscribe = onSnapshot(q, (snapshot) => {\n            const loadedSessions = snapshot.docs.map(doc => ({\n                id: doc.id,\n                ...doc.data()\n            }));\n\n            setSessions(loadedSessions);\n\n            if (loadedSessions.length === 0) {\n                setTimeout(() => createSession(), 0); \n            } else if (!currentSessionId || !loadedSessions.find(s => s.id === currentSessionId)) {\n                setCurrentSessionId(loadedSessions[0].id);\n            }\n        }, (error) => {\n            console.error(\"Firestore Sessions Error:\", error);\n            setErrorMessage(\"Failed to fetch chat sessions. Check Firebase Security Rules.\");\n        });\n\n        return () => unsubscribe();\n    }, [isAuthReady, db, userId, currentSessionId, createSession]);\n\n\n    // 3. Setup Messages Listener (Current Session)\n    useEffect(() => {\n        if (!isAuthReady || !db || !userId || !currentSessionId) {\n            setMessages([]); \n            return;\n        }\n\n        const messagesRef = collection(db, MESSAGES_COLLECTION_PATH(userId, currentSessionId));\n        const q = query(messagesRef, orderBy('createdAt', 'asc'), limit(50));\n\n        const unsubscribe = onSnapshot(q, (snapshot) => {\n            const loadedMessages = snapshot.docs.map(doc => {\n                const data = doc.data();\n                return {\n                    id: doc.id,\n                    sender: data.sender,\n                    text: data.text,\n                    createdAt: data.createdAt?.toDate ? data.createdAt.toDate() : new Date(), \n                };\n            });\n            setMessages(loadedMessages);\n\n            const lastBot = loadedMessages.slice().reverse().find(msg => msg.sender === 'bot');\n            setLastBotMessage(lastBot);\n\n        }, (error) => {\n            console.error(\"Firestore Messages Error:\", error);\n            setErrorMessage(\"Failed to fetch chat messages. Check Firebase Security Rules.\");\n        });\n\n        return () => unsubscribe();\n    }, [isAuthReady, db, userId, currentSessionId]);\n\n\n    // 4. Scroll to bottom on new messages/typing\n    useEffect(() => {\n        messageEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    }, [messages, isTyping]);\n\n\n    // 5. Check for TTS/STT capability and setup STT\n    useEffect(() => {\n        if ('speechSynthesis' in window && 'webkitSpeechRecognition' in window) {\n            setCanSpeak(true);\n        }\n\n        if ('webkitSpeechRecognition' in window) {\n            const recognitionInstance = new window.webkitSpeechRecognition();\n            recognitionInstance.continuous = false;\n            recognitionInstance.interimResults = false;\n            recognitionInstance.lang = 'en-US';\n            \n            recognitionInstance.onend = () => setIsListening(false);\n            recognitionInstance.onerror = (event) => {\n                console.error('Speech recognition error:', event.error);\n                if (event.error !== 'no-speech' && event.error !== 'not-allowed') {\n                    setErrorMessage(`Speech recognition error: ${event.error}`);\n                }\n                setIsListening(false);\n            };\n\n            recognitionRef.current = recognitionInstance;\n        }\n\n        return () => {\n            if (recognitionRef.current) {\n                recognitionRef.current.stop();\n                recognitionRef.current = null;\n            }\n        };\n    }, []);\n\n    // --- Firebase Actions ---\n\n    const switchSession = useCallback((sessionId) => {\n        setCurrentSessionId(sessionId);\n    }, []);\n\n    const deleteSession = async (sessionId) => {\n        if (!db || !userId) return;\n\n        // Use custom modal UI instead of window.confirm\n        if (!window.confirm(\"Are you sure you want to delete this chat session and all its messages?\")) {\n            return;\n        }\n\n        try {\n            const sessionDocRef = doc(db, SESSIONS_COLLECTION_PATH, userId, 'sessions', sessionId);\n            const messagesRef = collection(db, MESSAGES_COLLECTION_PATH(userId, sessionId));\n            \n            const batch = writeBatch(db);\n\n            const messageDocs = await getDocs(messagesRef);\n            messageDocs.docs.forEach(msgDoc => {\n                batch.delete(msgDoc.ref);\n            });\n            \n            batch.delete(sessionDocRef);\n\n            await batch.commit();\n\n            if (currentSessionId === sessionId) {\n                const remainingSessions = sessions.filter(s => s.id !== sessionId);\n                if (remainingSessions.length > 0) {\n                    setCurrentSessionId(remainingSessions[0].id);\n                } else {\n                    setCurrentSessionId(null);\n                    setTimeout(() => createSession(), 100); \n                }\n            }\n        } catch (e) {\n            console.error(\"Error deleting session:\", e);\n            setErrorMessage(\"Failed to delete the chat session.\");\n        }\n    };\n    \n    // --- TTS/STT Handlers ---\n\n    const handleSpeak = useCallback(async (text) => {\n        if (!canSpeak || !text) return;\n\n        setErrorMessage(null);\n\n        const audioUrl = await ttsApiCall(text, setErrorMessage);\n        if (audioUrl) {\n            const audio = new Audio(audioUrl);\n            audio.play();\n        }\n    }, [canSpeak]);\n\n    const saveMessage = async (sender, text) => {\n        if (!db || !userId || !currentSessionId || !text) return;\n\n        try {\n            const messagesRef = collection(db, MESSAGES_COLLECTION_PATH(userId, currentSessionId));\n            await addDoc(messagesRef, {\n                sender: sender,\n                text: text,\n                createdAt: serverTimestamp(),\n            });\n        } catch (e) {\n            console.error(\"Error saving message:\", e);\n            setErrorMessage(\"Failed to save message to database.\");\n        }\n    };\n\n    const handleSend = useCallback(async (transcript = null) => {\n        const textToSend = (transcript || input).trim();\n        if (isTyping || !textToSend || !currentSessionId) return;\n\n        setErrorMessage(null);\n        setIsTyping(true);\n        setInput(\"\"); // Clear input immediately\n\n        // 1. Save user message immediately (optimistically)\n        await saveMessage(\"user\", textToSend);\n\n        // 2. Start AI streaming response\n        let accumulatedBotText = \"\";\n        const historyForAI = messages.filter(msg => msg.text).map(msg => ({ sender: msg.sender, text: msg.text })); \n        const stream = askAIStream(textToSend, historyForAI);\n\n        // 3. Add a temporary message placeholder for streaming\n        const tempBotId = uuidv4();\n        // Since we are using Firestore's onSnapshot, we rely on the Firestore listener \n        // to update the messages array. We add a temporary message here to force\n        // the scroll and show the typing indicator before Firestore catches up.\n        setMessages(prev => [...prev, { id: tempBotId, sender: \"bot\", text: \"\" }]); \n\n        for await (const chunk of stream) {\n            accumulatedBotText += chunk;\n            // Update the temporary message with accumulated text\n            setMessages(prev => \n                prev.map(msg => \n                    msg.id === tempBotId ? { ...msg, text: accumulatedBotText } : msg\n                )\n            );\n\n            if (accumulatedBotText.includes(\"ERROR:\")) break;\n        }\n\n        setIsTyping(false);\n\n        if (!accumulatedBotText.includes(\"ERROR:\")) {\n            \n            // 4. Update session name if it's the first message in the session\n            const currentSession = sessions.find(s => s.id === currentSessionId);\n            if (currentSession && (currentSession.name?.startsWith('Chat ') || messages.length === 0)) {\n                const sessionDocRef = doc(db, SESSIONS_COLLECTION_PATH, userId, 'sessions', currentSessionId);\n                const sessionName = textToSend.substring(0, 30) + (textToSend.length > 30 ? '...' : '');\n                // Use updateDoc for renaming\n                await updateDoc(sessionDocRef, { name: sessionName });\n            }\n            \n            // 5. Save the final bot response (The snapshot listener will clean up the temp message)\n            await saveMessage(\"bot\", accumulatedBotText);\n            \n        } else {\n            // Remove the temporary message if it resulted in an error\n            setMessages(prev => prev.filter(msg => msg.id !== tempBotId));\n        }\n\n    }, [input, isTyping, currentSessionId, db, userId, messages, sessions]);\n\n\n    const startListening = useCallback(() => {\n        if (isTyping || !recognitionRef.current) return;\n        \n        setErrorMessage(null);\n        \n        const recognitionInstance = recognitionRef.current;\n        \n        recognitionInstance.onresult = (event) => {\n            const transcript = event.results[0][0].transcript;\n            setInput(transcript);\n            recognitionInstance.stop(); \n            // Send the message once listening stops\n            handleSend(transcript); \n        };\n\n        try {\n            recognitionInstance.start();\n            setIsListening(true);\n        } catch (e) {\n            if (e.name !== 'InvalidStateError') { \n                console.error(\"STT Start Error:\", e);\n                setErrorMessage(\"Speech recognition failed to start. Check microphone permissions.\");\n                setIsListening(false);\n            }\n        }\n    }, [isTyping, handleSend, setInput, setIsListening]); \n\n\n    // --- Render Logic ---\n    if (!isAuthReady) {\n        return (\n            <div className=\"flex justify-center items-center min-h-screen text-gray-600 bg-gray-100\">\n                <div className=\"p-6 bg-white rounded-xl shadow-lg\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mr-3 inline-block\"></div>\n                    <p className=\"inline-block\">Loading application and authenticating...</p>\n                </div>\n            </div>\n        );\n    }\n    \n    // Header component\n    const Header = () => (\n        <div className=\"p-4 bg-green-600 text-white shadow-md flex items-center justify-between\">\n            <button \n                className=\"md:hidden p-1 rounded-md hover:bg-green-700 transition\"\n                onClick={() => setIsSidebarOpen(!isSidebarOpen)}\n                title=\"Toggle Sidebar\"\n            >\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16m-7 6h7\" />\n                </svg>\n            </button>\n            <h1 className=\"text-xl font-bold flex-1 text-center md:text-left\">\n                Mene AI Chatbot\n            </h1>\n            <span className=\"hidden md:block text-sm opacity-80 bg-green-700 px-3 py-1 rounded-full\">\n                Session: {sessions.find(s => s.id === currentSessionId)?.name || \"New Chat\"}\n            </span>\n            <div className=\"hidden md:block text-xs font-mono opacity-60 ml-4\">\n                App ID: {appId.substring(0, 8)}...\n            </div>\n        </div>\n    );\n\n    // Main Chat Content\n    const chatContent = (\n        <div className=\"flex-1 flex flex-col min-w-0 bg-white\">\n            <Header />\n\n            {errorMessage && (\n                <div className=\"p-3 bg-red-100 text-red-700 text-sm text-center font-medium border-l-4 border-red-500\">\n                    {errorMessage}\n                </div>\n            )}\n\n            <div className=\"flex-1 p-4 space-y-4 overflow-y-auto custom-scrollbar\">\n                {messages.map((msg) => (\n                    <div \n                        key={msg.id} \n                        className={`flex ${msg.sender === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n                    >\n                        <div\n                            className={`max-w-xs md:max-w-md lg:max-w-lg p-3 rounded-xl shadow-md text-sm ${\n                                msg.sender === \"user\"\n                                    ? \"bg-blue-500 text-white rounded-br-none\"\n                                    : \"bg-gray-200 text-gray-800 rounded-tl-none\"\n                            }`}\n                            onClick={msg.sender === \"bot\" && canSpeak ? () => handleSpeak(msg.text) : null}\n                            style={msg.sender === \"bot\" && canSpeak ? {cursor: 'pointer'} : {}}\n                            title={msg.sender === \"bot\" && canSpeak ? \"Click to hear this message\" : null}\n                        >\n                            {msg.text}\n                        </div>\n                    </div>\n                ))}\n\n                {isTyping && (\n                    <div className=\"flex justify-start\">\n                        <div className=\"max-w-xs p-3 rounded-xl bg-gray-100 text-gray-500 italic text-sm shadow-sm\">\n                            <span className=\"dot-pulse mr-2\"></span> Mene is generating...\n                        </div>\n                    </div>\n                )}\n\n                <div ref={messageEndRef} />\n            </div>\n\n            {/* Input Area */}\n            <div className=\"p-3 border-t border-gray-200 flex items-center space-x-2 bg-gray-50\">\n                {/* STT Button */}\n                <button \n                    className={`p-3 rounded-full transition duration-150 shadow-md ${\n                        isListening \n                            ? 'bg-red-500 text-white animate-pulse' \n                            : 'bg-gray-300 text-gray-700 hover:bg-gray-400'\n                    }`}\n                    onClick={startListening} \n                    disabled={isTyping || !canSpeak} \n                    title={isListening ? \"Listening...\" : \"Start voice input (STT)\"}\n                >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path d=\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4z\" />\n                        <path d=\"M5.5 9.5a.5.5 0 011 0v4a.5.5 0 01-1 0v-4zM13.5 9.5a.5.5 0 011 0v4a.5.5 0 01-1 0v-4z\" />\n                        <path d=\"M10 18a.75.75 0 01-.75-.75V15a.75.75 0 011.5 0v2.25A.75.75 0 0110 18zm6.5-6.5a.5.5 0 01-1 0v-4a.5.5 0 011 0v4zM3.5 11.5a.5.5 0 011 0v-4a.5.5 0 01-1 0v4z\" />\n                        <path d=\"M5 9.75a.75.75 0 01.75-.75h8.5a.75.75 0 010 1.5H5.75A.75.75 0 015 9.75z\" />\n                        <path d=\"M15 11a1 1 0 011 1v2a4 4 0 01-8 0v-2a1 1 0 011-1h6z\" />\n                    </svg>\n                </button>\n\n                {/* Text Input */}\n                <input\n                    type=\"text\"\n                    value={input}\n                    onChange={(e) => setInput(e.target.value)}\n                    // *** FIX: Added onKeyDown handler for Enter to send ***\n                    onKeyDown={(e) => e.key === \"Enter\" && handleSend()}\n                    placeholder=\"Ask Mene anything...\"\n                    disabled={isTyping}\n                    className=\"flex-1 p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150\"\n                />\n                \n                {/* TTS Button */}\n                <button \n                    className={`p-3 rounded-full transition duration-150 shadow-md ${\n                        canSpeak && !isTyping && lastBotMessage\n                            ? 'bg-green-500 text-white hover:bg-green-600'\n                            : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                    }`}\n                    onClick={() => handleSpeak(lastBotMessage?.text)}\n                    disabled={isTyping || !canSpeak || !lastBotMessage}\n                    title=\"Read last bot message aloud (TTS)\"\n                >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path d=\"M9.383 3.003c.125-.466.52-.803.955-.803h.305c.435 0 .83.337.955.803l.36 1.353a1.5 1.5 0 001.037.989l.254.053c1.685.356 2.5 1.776 2.5 3.328v2.96c0 1.552-.815 2.972-2.5 3.328l-.254.053a1.5 1.5 0 00-1.037.989l-.36 1.353c-.125.466-.52.803-.955.803h-.305c-.435 0-.83-.337-.955.803l-.36-1.353a1.5 1.5 0 00-1.037-.989l-.254-.053c-1.685-.356-2.5-1.776-2.5-3.328v-2.96c0-1.552.815-2.972 2.5-3.328l.254-.053a1.5 1.5 0 001.037-.989l.36-1.353zM10 7a1 1 0 100 2 1 1 0 000-2zm0 4a1 1 0 100 2 1 1 0 000-2z\" />\n                    </svg>\n                </button>\n\n                {/* Send Button */}\n                <button \n                    className={`p-3 rounded-full transition duration-150 shadow-md ${\n                        isTyping || !input.trim()\n                            ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                            : 'bg-green-500 text-white hover:bg-green-600'\n                    }`}\n                    onClick={() => handleSend()} \n                    disabled={isTyping || !input.trim()}\n                    title=\"Send Message\"\n                >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path d=\"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l4.47-1.405 6.447 3.376a1 1 0 00.999 0l6.447-3.376 4.47 1.405a1 1 0 001.169-1.409l-7-14z\" />\n                    </svg>\n                </button>\n            </div>\n        </div>\n    );\n\n    // Final Application Layout (Desktop/Mobile Responsive)\n    return (\n        <div className=\"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-0 md:p-4 font-inter\">\n            {/* Tailwind CSS Script and Custom Styles */}\n            <script src=\"https://cdn.tailwindcss.com\"></script>\n            <style>\n                {`\n                    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\n                    body { font-family: 'Inter', sans-serif; }\n                    .custom-scrollbar::-webkit-scrollbar { width: 8px; }\n                    .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }\n                    .custom-scrollbar::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }\n                    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #999; }\n\n                    /* Typing Indicator (Dot Pulse) */\n                    .dot-pulse {\n                        position: relative;\n                        left: -9999px;\n                        width: 5px;\n                        height: 5px;\n                        border-radius: 50%;\n                        background-color: #9ca3af; /* gray-400 */\n                        color: #9ca3af;\n                        box-shadow: 9999px 0 0 -5px;\n                        animation: dotPulse 1.5s infinite linear;\n                        animation-delay: 0.25s;\n                        display: inline-block;\n                        margin-right: 8px;\n                    }\n                    .dot-pulse::before, .dot-pulse::after {\n                        content: '';\n                        display: inline-block;\n                        position: absolute;\n                        top: 0;\n                        width: 5px;\n                        height: 5px;\n                        border-radius: 50%;\n                        background-color: #9ca3af;\n                        color: #9ca3af;\n                    }\n                    .dot-pulse::before {\n                        box-shadow: 9999px 0 0 -5px;\n                        animation: dotPulseBefore 1.5s infinite linear;\n                        animation-delay: 0s;\n                        left: -15px;\n                    }\n                    .dot-pulse::after {\n                        box-shadow: 9999px 0 0 -5px;\n                        animation: dotPulseAfter 1.5s infinite linear;\n                        animation-delay: 0.5s;\n                        left: 15px;\n                    }\n\n                    @keyframes dotPulseBefore {\n                        0% { box-shadow: 9999px 0 0 -5px; }\n                        30% { box-shadow: 9999px 0 0 2px; }\n                        60%, 100% { box-shadow: 9999px 0 0 -5px; }\n                    }\n                    @keyframes dotPulse {\n                        0% { box-shadow: 9999px 0 0 -5px; }\n                        30% { box-shadow: 9999px 0 0 2px; }\n                        60%, 100% { box-shadow: 9999px 0 0 -5px; }\n                    }\n                    @keyframes dotPulseAfter {\n                        0% { box-shadow: 9999px 0 0 -5px; }\n                        30% { box-shadow: 9999px 0 0 2px; }\n                        60%, 100% { box-shadow: 9999px 0 0 -5px; }\n                    }\n\n                    /* Sidebar Positioning */\n                    .sidebar-container {\n                        position: fixed;\n                        top: 0;\n                        left: 0;\n                        height: 100vh;\n                        z-index: 40;\n                        transition: transform 0.3s ease-in-out;\n                        width: 16rem; \n                    }\n\n                    @media (min-width: 768px) {\n                        .sidebar-container {\n                            position: static;\n                            height: auto;\n                            transform: translateX(0) !important;\n                            width: 16rem; \n                            flex-shrink: 0; /* Prevents it from shrinking */\n                        }\n                    }\n                `}\n            </style>\n            \n            <div className=\"w-full h-screen md:w-full md:max-w-6xl md:h-[90vh] flex bg-white md:rounded-xl shadow-2xl overflow-hidden transition-all duration-300\">\n                \n                {/* Sidebar (Conversations Menu) */}\n                {/* Overlay needs to be a sibling of the sidebar content for correct z-index on mobile */}\n                <div \n                    className={`sidebar-container ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0`}\n                >\n                    <Sidebar \n                        sessions={sessions}\n                        currentSessionId={currentSessionId}\n                        switchSession={switchSession}\n                        createNewSession={createSession}\n                        deleteSession={deleteSession}\n                        userId={userId}\n                        isSidebarOpen={isSidebarOpen}\n                        setIsSidebarOpen={setIsSidebarOpen}\n                    />\n                </div>\n                {isSidebarOpen && window.innerWidth < 768 && (\n                    <div \n                        className=\"fixed inset-0 bg-black opacity-50 md:hidden z-30\" \n                        onClick={() => setIsSidebarOpen(false)}\n                    ></div>\n                )}\n\n                {/* Main Chat Area */}\n                <div className=\"flex-1 flex flex-col min-w-0 z-10\">\n                    {chatContent}\n                </div>\n            </div>\n        </div>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}