{"ast":null,"code":"import _asyncIterator from\"/workspaces/MeneBot-/node_modules/@babel/runtime/helpers/esm/asyncIterator.js\";import React,{useState,useEffect,useRef}from\"react\";import{askAIStream,generateTtsAudio}from\"../services/api.jsx\";import{v4 as uuidv4}from'uuid';// Import uuid for message IDs\nimport{initializeApp}from'firebase/app';import{getAuth,signInAnonymously,signInWithCustomToken,onAuthStateChanged}from'firebase/auth';import{getFirestore,collection,query,onSnapshot,addDoc,orderBy,limit,serverTimestamp,setLogLevel}from'firebase/firestore';// --- ENVIRONMENT VARIABLE HANDLING (Fixes ESLint/no-undef errors) ---\n// These variables are injected by the Canvas environment for Firebase setup.\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const appId=typeof __app_id!=='undefined'?__app_id:'default-app-id';const firebaseConfig=typeof __firebase_config!=='undefined'?JSON.parse(__firebase_config):null;const initialAuthToken=typeof __initial_auth_token!=='undefined'?__initial_auth_token:null;// The collection path for public chat data\nconst PUBLIC_COLLECTION_PATH=\"/artifacts/\".concat(appId,\"/public/data/chat_messages\");// --- END ENVIRONMENT VARIABLE HANDLING ---\n// --- Text-to-Speech (TTS) Utility Functions ---\n// The Gemini TTS API returns raw PCM audio data. This must be wrapped in a WAV container to be played.\n/**\n * Converts a base64 string to an ArrayBuffer.\n * @param {string} base64 - The base64 string.\n * @returns {ArrayBuffer}\n */const base64ToArrayBuffer=base64=>{const binaryString=atob(base64);const len=binaryString.length;const bytes=new Uint8Array(len);for(let i=0;i<len;i++){bytes[i]=binaryString.charCodeAt(i);}return bytes.buffer;};/**\n * Wraps signed 16-bit PCM audio data in a WAV container.\n * @param {Int16Array} pcm16 - Raw signed 16-bit PCM data.\n * @param {number} sampleRate - The sample rate of the audio (e.g., 16000).\n * @returns {Blob} - A Blob containing the WAV file.\n */const pcmToWav=(pcm16,sampleRate)=>{const numChannels=1;const bitsPerSample=16;const blockAlign=numChannels*(bitsPerSample/8);const byteRate=sampleRate*blockAlign;const buffer=new ArrayBuffer(44+pcm16.byteLength);const view=new DataView(buffer);// Helper function to write a string to a DataView\nconst writeString=(view,offset,string)=>{for(let i=0;i<string.length;i++){view.setUint8(offset+i,string.charCodeAt(i));}};// RIFF header\nwriteString(view,0,'RIFF');// ChunkID\nview.setUint32(4,36+pcm16.byteLength,true);// ChunkSize\nwriteString(view,8,'WAVE');// Format\n// FMT sub-chunk\nwriteString(view,12,'fmt ');// Subchunk1ID\nview.setUint32(16,16,true);// Subchunk1Size (16 for PCM)\nview.setUint16(20,1,true);// AudioFormat (1 for PCM)\nview.setUint16(22,numChannels,true);// NumChannels\nview.setUint32(24,sampleRate,true);// SampleRate\nview.setUint32(28,byteRate,true);// ByteRate\nview.setUint16(32,blockAlign,true);// BlockAlign\nview.setUint16(34,bitsPerSample,true);// BitsPerSample\n// DATA sub-chunk\nwriteString(view,36,'data');// Subchunk2ID\nview.setUint32(40,pcm16.byteLength,true);// Subchunk2Size\n// Write PCM data\n// Int16Array data is already in the correct format (little-endian)\nnew Int16Array(buffer,44).set(pcm16);return new Blob([buffer],{type:'audio/wav'});};// --- Main Component ---\nexport default function Chatbot(){// Firebase and Auth States\nconst[db,setDb]=useState(null);const[auth,setAuth]=useState(null);const[userId,setUserId]=useState(null);const[isAuthReady,setIsAuthReady]=useState(false);const[firebaseError,setFirebaseError]=useState(null);// Chat States\nconst[messages,setMessages]=useState([]);const[input,setInput]=useState('');const[isTyping,setIsTyping]=useState(false);// TTS/Speech Recognition States\nconst[canSpeak,setCanSpeak]=useState(false);const[isListening,setIsListening]=useState(false);const messageEndRef=useRef(null);const audioRef=useRef(new Audio());const recognitionRef=useRef(null);// --- UTILITY FUNCTIONS ---\n// Scroll to the latest message\nconst scrollToBottom=()=>{var _messageEndRef$curren;(_messageEndRef$curren=messageEndRef.current)===null||_messageEndRef$curren===void 0?void 0:_messageEndRef$curren.scrollIntoView({behavior:\"smooth\"});};// Play TTS Audio\nconst handleSpeak=async text=>{if(!canSpeak||!text)return;// Stop current audio if playing\naudioRef.current.pause();audioRef.current.src='';try{// Show a temporary indicator that audio is loading\nsetIsTyping(true);const{audioData,sampleRate}=await generateTtsAudio(text);// Convert and play\nconst pcmData=base64ToArrayBuffer(audioData);const pcm16=new Int16Array(pcmData);const wavBlob=pcmToWav(pcm16,sampleRate);audioRef.current.src=URL.createObjectURL(wavBlob);audioRef.current.play();// Clean up the URL after playing\naudioRef.current.onended=()=>{URL.revokeObjectURL(audioRef.current.src);setIsTyping(false);};}catch(error){console.error(\"TTS Playback Error:\",error);// Add a temporary error message to the chat\nconst tempErrorMsg={id:uuidv4(),text:\"[TTS Error] Cannot read message: \".concat(error.message),sender:'system',timestamp:serverTimestamp()};await addDoc(collection(db,PUBLIC_COLLECTION_PATH),tempErrorMsg);setIsTyping(false);}};// Speech-to-Text Recognition\nconst startListening=()=>{if(isListening||isTyping)return;// Ensure Web Speech API is supported\nconst SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;if(!SpeechRecognition){alert(\"Speech recognition is not supported in this browser.\");return;}const recognition=new SpeechRecognition();recognition.continuous=false;recognition.interimResults=false;recognition.lang='en-US';recognition.onstart=()=>{setIsListening(true);setInput(\"Listening...\");};recognition.onresult=event=>{const transcript=event.results[0][0].transcript;setInput(transcript);};recognition.onend=()=>{setIsListening(false);// If we got a result, submit it automatically\nif(input!==\"Listening...\"&&input.trim()){handleSend(input);}};recognition.onerror=event=>{console.error('Speech recognition error:',event.error);setIsListening(false);setInput(\"\");// User feedback for error (e.g., no mic found, blocked permission)\nalert(\"Speech Error: \".concat(event.error,\". Please check microphone permissions.\"));};recognitionRef.current=recognition;recognition.start();};// --- CHAT LOGIC ---\nconst handleSend=async function(){let voiceInput=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;const messageText=(voiceInput||input).trim();if(!messageText||isTyping||!db||!userId)return;setInput('');// Clear input box immediately\nconst userMessage={id:uuidv4(),text:messageText,sender:'user',userId:userId,timestamp:serverTimestamp()};try{// 1. Save user message to Firestore\nawait addDoc(collection(db,PUBLIC_COLLECTION_PATH),userMessage);// 2. Start AI generation (non-blocking)\nsetIsTyping(true);let botResponseText='';// Create an async iterator for the \"stream\"\nconst stream=askAIStream(messageText);// Create a placeholder bot message document in Firestore for streaming\nconst botMessageRef=await addDoc(collection(db,PUBLIC_COLLECTION_PATH),{id:uuidv4(),text:'',// Start empty\nsender:'bot',userId:'MeneBot',timestamp:serverTimestamp()});// 3. Process the \"stream\" of chunks\nvar _iteratorAbruptCompletion=false;var _didIteratorError=false;var _iteratorError;try{for(var _iterator=_asyncIterator(stream),_step;_iteratorAbruptCompletion=!(_step=await _iterator.next()).done;_iteratorAbruptCompletion=false){const chunk=_step.value;{if(chunk.startsWith('ERROR:')){botResponseText=chunk;break;}// Accumulate text and update the placeholder document\nbotResponseText+=chunk;// Update Firestore document frequently to simulate real-time typing\nawait updateDoc(botMessageRef,{text:botResponseText});}}// 4. Final update and cleanup\n}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(_iteratorAbruptCompletion&&_iterator.return!=null){await _iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}setIsTyping(false);// The onSnapshot listener handles updating the UI automatically\n}catch(error){console.error(\"Chat Send Error:\",error);setIsTyping(false);// Log a system error message to the chat\nawait addDoc(collection(db,PUBLIC_COLLECTION_PATH),{id:uuidv4(),text:\"System Error: Failed to send or process message. \".concat(error.message),sender:'system',timestamp:serverTimestamp()});}};// --- EFFECTS ---\n// 1. Firebase Initialization and Authentication\nuseEffect(()=>{if(!firebaseConfig){setFirebaseError(\"Firebase configuration is missing.\");return;}try{setLogLevel('debug');const app=initializeApp(firebaseConfig);const firestore=getFirestore(app);const authentication=getAuth(app);setDb(firestore);setAuth(authentication);// Listen for auth state changes\nconst unsubscribe=onAuthStateChanged(authentication,user=>{if(user){setUserId(user.uid);}else{// Sign in with custom token if available, otherwise anonymously\n(async()=>{try{if(initialAuthToken){await signInWithCustomToken(authentication,initialAuthToken);}else{await signInAnonymously(authentication);}}catch(e){console.error(\"Firebase Auth Error:\",e);setFirebaseError(\"Authentication failed. \".concat(e.message));setUserId('guest-error');}setIsAuthReady(true);})();}});return()=>unsubscribe();}catch(e){console.error(\"Firebase Initialization Failed:\",e);setFirebaseError(\"Failed to initialize Firebase. \".concat(e.message));setIsAuthReady(true);}},[firebaseConfig,initialAuthToken]);// Runs only once on mount\n// 2. Firestore Real-time Listener (Chat Messages)\nuseEffect(()=>{if(!isAuthReady||!db||!userId)return;// Query: Get last 50 messages, ordered by timestamp\nconst q=query(collection(db,PUBLIC_COLLECTION_PATH),orderBy('timestamp','desc'),limit(50)// Limit to the last 50 messages for performance\n);const unsubscribe=onSnapshot(q,snapshot=>{const fetchedMessages=snapshot.docs.map(doc=>{var _data$timestamp;const data=doc.data();return{id:doc.id,text:data.text,sender:data.sender,userId:data.userId,// Convert Firebase Timestamp to JS Date object for sorting if needed\ntimestamp:(_data$timestamp=data.timestamp)!==null&&_data$timestamp!==void 0&&_data$timestamp.toDate?data.timestamp.toDate():new Date()};}).reverse();// Reverse to display in chronological order\nsetMessages(fetchedMessages);},error=>{console.error(\"Firestore Listener Error:\",error);setFirebaseError(\"Failed to load chat history. \".concat(error.message));});// Cleanup the listener on unmount or dependency change\nreturn()=>unsubscribe();},[isAuthReady,db,userId]);// Reruns when auth is ready or db/userId changes\n// 3. Scroll to bottom on message update\nuseEffect(()=>{scrollToBottom();},[messages]);// 4. Check TTS/STT capability\nuseEffect(()=>{setCanSpeak('speechSynthesis'in window&&'AudioContext'in window);// Note: Speech recognition capability is checked in startListening\n},[]);const lastBotMessage=messages.slice().reverse().find(msg=>msg.sender==='bot');if(firebaseError){return/*#__PURE__*/_jsxs(\"div\",{className:\"p-8 bg-red-100 border border-red-400 text-red-700 rounded-lg max-w-md mx-auto my-12\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold mb-2\",children:\"Application Error\"}),/*#__PURE__*/_jsx(\"p\",{children:firebaseError}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-sm\",children:\"Please check your Firebase configuration and network connection.\"})]});}if(!isAuthReady){return/*#__PURE__*/_jsxs(\"div\",{className:\"p-8 bg-white rounded-xl shadow-lg max-w-md mx-auto my-12 text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-gray-600\",children:\"Connecting to Firebase and authenticating...\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-md h-[80vh] bg-white rounded-xl flex flex-col overflow-hidden border-2 border-gray-200 shadow-2xl\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-primary text-white p-3 text-lg font-extrabold flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-2\",children:\"\\uD83E\\uDD16 Mene AI Chatbot\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs bg-white text-primary px-2 py-1 rounded-full font-medium\",children:[\"User: \",userId]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"messages-container flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50\",children:[messages.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-gray-500 italic pt-10\",children:\"Start a conversation! Your messages will be shared publicly.\"}),messages.map(msg=>/*#__PURE__*/_jsxs(\"div\",{// Message Styling based on sender\nclassName:\"max-w-[75%] p-3 rounded-xl shadow transition-all duration-300 \".concat(msg.sender==='user'?'ml-auto bg-blue-500 text-white rounded-br-none':msg.sender==='bot'?'mr-auto bg-gray-200 text-gray-800 rounded-tl-none hover:shadow-lg':'mx-auto bg-yellow-100 text-gray-700 text-sm'// System message\n)// Enable TTS click only for bot messages when capable\n,onClick:msg.sender===\"bot\"&&canSpeak?()=>handleSpeak(msg.text):null,title:msg.sender===\"bot\"&&canSpeak?\"Click to hear this message\":null,children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-semibold mb-1 opacity-70\",children:msg.sender==='user'?'You':msg.sender==='bot'?'Mene Bot':'System'}),msg.text]},msg.id)),isTyping&&/*#__PURE__*/_jsx(\"div\",{className:\"mr-auto p-3 rounded-xl rounded-tl-none bg-gray-200 text-gray-500 italic shadow max-w-xs\",children:\"Mene is generating...\"}),/*#__PURE__*/_jsx(\"div\",{ref:messageEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 flex gap-2 border-t border-gray-200 bg-white items-center\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"p-3 rounded-full text-white transition duration-300 \".concat(isListening?'bg-red-500 animate-pulse':isTyping?'bg-gray-400 cursor-not-allowed':'bg-primary hover:bg-secondary'),onClick:startListening,disabled:isTyping,title:isListening?\"Stop listening\":\"Start voice input\",children:\"\\uD83C\\uDFA4\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:input,onChange:e=>setInput(e.target.value),onKeyDown:e=>e.key===\"Enter\"&&handleSend(),placeholder:isListening?\"Speak now...\":\"Ask Mene anything...\",className:\"flex-1 p-3 rounded-full border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition duration-150\",disabled:isTyping}),/*#__PURE__*/_jsx(\"button\",{className:\"p-3 rounded-full text-white transition duration-300 \".concat(!(lastBotMessage!==null&&lastBotMessage!==void 0&&lastBotMessage.text)||isTyping||!canSpeak?'bg-gray-400 cursor-not-allowed':'bg-primary hover:bg-secondary'),onClick:()=>handleSpeak(lastBotMessage===null||lastBotMessage===void 0?void 0:lastBotMessage.text),disabled:isTyping||!(lastBotMessage!==null&&lastBotMessage!==void 0&&lastBotMessage.text)||!canSpeak,title:\"Read last bot message aloud\",children:\"\\uD83D\\uDD0A\"}),/*#__PURE__*/_jsx(\"button\",{className:\"p-3 px-4 rounded-full text-white font-bold transition duration-300 \".concat(isTyping||!input.trim()?'bg-gray-400 cursor-not-allowed':'bg-primary hover:bg-secondary'),onClick:()=>handleSend(),disabled:isTyping||!input.trim(),children:\"Send\"})]})]});}","map":{"version":3,"names":["React","useState","useEffect","useRef","askAIStream","generateTtsAudio","v4","uuidv4","initializeApp","getAuth","signInAnonymously","signInWithCustomToken","onAuthStateChanged","getFirestore","collection","query","onSnapshot","addDoc","orderBy","limit","serverTimestamp","setLogLevel","jsx","_jsx","jsxs","_jsxs","appId","__app_id","firebaseConfig","__firebase_config","JSON","parse","initialAuthToken","__initial_auth_token","PUBLIC_COLLECTION_PATH","concat","base64ToArrayBuffer","base64","binaryString","atob","len","length","bytes","Uint8Array","i","charCodeAt","buffer","pcmToWav","pcm16","sampleRate","numChannels","bitsPerSample","blockAlign","byteRate","ArrayBuffer","byteLength","view","DataView","writeString","offset","string","setUint8","setUint32","setUint16","Int16Array","set","Blob","type","Chatbot","db","setDb","auth","setAuth","userId","setUserId","isAuthReady","setIsAuthReady","firebaseError","setFirebaseError","messages","setMessages","input","setInput","isTyping","setIsTyping","canSpeak","setCanSpeak","isListening","setIsListening","messageEndRef","audioRef","Audio","recognitionRef","scrollToBottom","_messageEndRef$curren","current","scrollIntoView","behavior","handleSpeak","text","pause","src","audioData","pcmData","wavBlob","URL","createObjectURL","play","onended","revokeObjectURL","error","console","tempErrorMsg","id","message","sender","timestamp","startListening","SpeechRecognition","window","webkitSpeechRecognition","alert","recognition","continuous","interimResults","lang","onstart","onresult","event","transcript","results","onend","trim","handleSend","onerror","start","voiceInput","arguments","undefined","messageText","userMessage","botResponseText","stream","botMessageRef","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_asyncIterator","_step","next","done","chunk","value","startsWith","updateDoc","err","return","app","firestore","authentication","unsubscribe","user","uid","e","q","snapshot","fetchedMessages","docs","map","doc","_data$timestamp","data","toDate","Date","reverse","lastBotMessage","slice","find","msg","className","children","onClick","title","ref","disabled","onChange","target","onKeyDown","key","placeholder"],"sources":["/workspaces/MeneBot-/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { askAIStream, generateTtsAudio } from \"../services/api.jsx\";\nimport { v4 as uuidv4 } from 'uuid'; // Import uuid for message IDs\nimport { \n    initializeApp \n} from 'firebase/app';\nimport { \n    getAuth, \n    signInAnonymously, \n    signInWithCustomToken, \n    onAuthStateChanged,\n} from 'firebase/auth';\nimport { \n    getFirestore, \n    collection, \n    query, \n    onSnapshot, \n    addDoc, \n    orderBy,\n    limit,\n    serverTimestamp,\n    setLogLevel\n} from 'firebase/firestore';\n\n\n// --- ENVIRONMENT VARIABLE HANDLING (Fixes ESLint/no-undef errors) ---\n// These variables are injected by the Canvas environment for Firebase setup.\nconst appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\nconst firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\nconst initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\n\n// The collection path for public chat data\nconst PUBLIC_COLLECTION_PATH = `/artifacts/${appId}/public/data/chat_messages`;\n// --- END ENVIRONMENT VARIABLE HANDLING ---\n\n\n// --- Text-to-Speech (TTS) Utility Functions ---\n// The Gemini TTS API returns raw PCM audio data. This must be wrapped in a WAV container to be played.\n\n/**\n * Converts a base64 string to an ArrayBuffer.\n * @param {string} base64 - The base64 string.\n * @returns {ArrayBuffer}\n */\nconst base64ToArrayBuffer = (base64) => {\n    const binaryString = atob(base64);\n    const len = binaryString.length;\n    const bytes = new Uint8Array(len);\n    for (let i = 0; i < len; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n    }\n    return bytes.buffer;\n};\n\n/**\n * Wraps signed 16-bit PCM audio data in a WAV container.\n * @param {Int16Array} pcm16 - Raw signed 16-bit PCM data.\n * @param {number} sampleRate - The sample rate of the audio (e.g., 16000).\n * @returns {Blob} - A Blob containing the WAV file.\n */\nconst pcmToWav = (pcm16, sampleRate) => {\n    const numChannels = 1;\n    const bitsPerSample = 16;\n    const blockAlign = numChannels * (bitsPerSample / 8);\n    const byteRate = sampleRate * blockAlign;\n\n    const buffer = new ArrayBuffer(44 + pcm16.byteLength);\n    const view = new DataView(buffer);\n\n    // Helper function to write a string to a DataView\n    const writeString = (view, offset, string) => {\n        for (let i = 0; i < string.length; i++) {\n            view.setUint8(offset + i, string.charCodeAt(i));\n        }\n    };\n\n    // RIFF header\n    writeString(view, 0, 'RIFF'); // ChunkID\n    view.setUint32(4, 36 + pcm16.byteLength, true); // ChunkSize\n    writeString(view, 8, 'WAVE'); // Format\n\n    // FMT sub-chunk\n    writeString(view, 12, 'fmt '); // Subchunk1ID\n    view.setUint32(16, 16, true); // Subchunk1Size (16 for PCM)\n    view.setUint16(20, 1, true); // AudioFormat (1 for PCM)\n    view.setUint16(22, numChannels, true); // NumChannels\n    view.setUint32(24, sampleRate, true); // SampleRate\n    view.setUint32(28, byteRate, true); // ByteRate\n    view.setUint16(32, blockAlign, true); // BlockAlign\n    view.setUint16(34, bitsPerSample, true); // BitsPerSample\n\n    // DATA sub-chunk\n    writeString(view, 36, 'data'); // Subchunk2ID\n    view.setUint32(40, pcm16.byteLength, true); // Subchunk2Size\n\n    // Write PCM data\n    // Int16Array data is already in the correct format (little-endian)\n    new Int16Array(buffer, 44).set(pcm16);\n\n    return new Blob([buffer], { type: 'audio/wav' });\n};\n\n// --- Main Component ---\nexport default function Chatbot() {\n    // Firebase and Auth States\n    const [db, setDb] = useState(null);\n    const [auth, setAuth] = useState(null);\n    const [userId, setUserId] = useState(null);\n    const [isAuthReady, setIsAuthReady] = useState(false);\n    const [firebaseError, setFirebaseError] = useState(null);\n\n    // Chat States\n    const [messages, setMessages] = useState([]);\n    const [input, setInput] = useState('');\n    const [isTyping, setIsTyping] = useState(false);\n    \n    // TTS/Speech Recognition States\n    const [canSpeak, setCanSpeak] = useState(false);\n    const [isListening, setIsListening] = useState(false);\n\n    const messageEndRef = useRef(null);\n    const audioRef = useRef(new Audio());\n    const recognitionRef = useRef(null);\n\n    // --- UTILITY FUNCTIONS ---\n\n    // Scroll to the latest message\n    const scrollToBottom = () => {\n        messageEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    };\n\n    // Play TTS Audio\n    const handleSpeak = async (text) => {\n        if (!canSpeak || !text) return;\n\n        // Stop current audio if playing\n        audioRef.current.pause();\n        audioRef.current.src = '';\n        \n        try {\n            // Show a temporary indicator that audio is loading\n            setIsTyping(true);\n\n            const { audioData, sampleRate } = await generateTtsAudio(text);\n            \n            // Convert and play\n            const pcmData = base64ToArrayBuffer(audioData);\n            const pcm16 = new Int16Array(pcmData);\n            const wavBlob = pcmToWav(pcm16, sampleRate);\n            audioRef.current.src = URL.createObjectURL(wavBlob);\n            \n            audioRef.current.play();\n\n            // Clean up the URL after playing\n            audioRef.current.onended = () => {\n                URL.revokeObjectURL(audioRef.current.src);\n                setIsTyping(false);\n            };\n\n        } catch (error) {\n            console.error(\"TTS Playback Error:\", error);\n            // Add a temporary error message to the chat\n            const tempErrorMsg = { \n                id: uuidv4(), \n                text: `[TTS Error] Cannot read message: ${error.message}`, \n                sender: 'system', \n                timestamp: serverTimestamp() \n            };\n            await addDoc(collection(db, PUBLIC_COLLECTION_PATH), tempErrorMsg);\n            setIsTyping(false);\n        }\n    };\n    \n    // Speech-to-Text Recognition\n    const startListening = () => {\n        if (isListening || isTyping) return;\n        \n        // Ensure Web Speech API is supported\n        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n        if (!SpeechRecognition) {\n            alert(\"Speech recognition is not supported in this browser.\");\n            return;\n        }\n\n        const recognition = new SpeechRecognition();\n        recognition.continuous = false;\n        recognition.interimResults = false;\n        recognition.lang = 'en-US'; \n        \n        recognition.onstart = () => {\n            setIsListening(true);\n            setInput(\"Listening...\");\n        };\n\n        recognition.onresult = (event) => {\n            const transcript = event.results[0][0].transcript;\n            setInput(transcript);\n        };\n\n        recognition.onend = () => {\n            setIsListening(false);\n            // If we got a result, submit it automatically\n            if (input !== \"Listening...\" && input.trim()) {\n                handleSend(input);\n            }\n        };\n\n        recognition.onerror = (event) => {\n            console.error('Speech recognition error:', event.error);\n            setIsListening(false);\n            setInput(\"\");\n            // User feedback for error (e.g., no mic found, blocked permission)\n            alert(`Speech Error: ${event.error}. Please check microphone permissions.`);\n        };\n        \n        recognitionRef.current = recognition;\n        recognition.start();\n    };\n\n    // --- CHAT LOGIC ---\n    const handleSend = async (voiceInput = null) => {\n        const messageText = (voiceInput || input).trim();\n        if (!messageText || isTyping || !db || !userId) return;\n\n        setInput(''); // Clear input box immediately\n\n        const userMessage = {\n            id: uuidv4(),\n            text: messageText,\n            sender: 'user',\n            userId: userId,\n            timestamp: serverTimestamp(),\n        };\n\n        try {\n            // 1. Save user message to Firestore\n            await addDoc(collection(db, PUBLIC_COLLECTION_PATH), userMessage);\n\n            // 2. Start AI generation (non-blocking)\n            setIsTyping(true);\n            let botResponseText = '';\n            \n            // Create an async iterator for the \"stream\"\n            const stream = askAIStream(messageText);\n\n            // Create a placeholder bot message document in Firestore for streaming\n            const botMessageRef = await addDoc(collection(db, PUBLIC_COLLECTION_PATH), {\n                id: uuidv4(),\n                text: '', // Start empty\n                sender: 'bot',\n                userId: 'MeneBot',\n                timestamp: serverTimestamp(),\n            });\n\n            // 3. Process the \"stream\" of chunks\n            for await (const chunk of stream) {\n                if (chunk.startsWith('ERROR:')) {\n                    botResponseText = chunk;\n                    break;\n                }\n                // Accumulate text and update the placeholder document\n                botResponseText += chunk;\n                // Update Firestore document frequently to simulate real-time typing\n                await updateDoc(botMessageRef, { text: botResponseText }); \n            }\n\n            // 4. Final update and cleanup\n            setIsTyping(false);\n            // The onSnapshot listener handles updating the UI automatically\n            \n        } catch (error) {\n            console.error(\"Chat Send Error:\", error);\n            setIsTyping(false);\n            // Log a system error message to the chat\n            await addDoc(collection(db, PUBLIC_COLLECTION_PATH), {\n                id: uuidv4(), \n                text: `System Error: Failed to send or process message. ${error.message}`, \n                sender: 'system', \n                timestamp: serverTimestamp() \n            });\n        }\n    };\n\n\n    // --- EFFECTS ---\n\n    // 1. Firebase Initialization and Authentication\n    useEffect(() => {\n        if (!firebaseConfig) {\n            setFirebaseError(\"Firebase configuration is missing.\");\n            return;\n        }\n        \n        try {\n            setLogLevel('debug');\n            const app = initializeApp(firebaseConfig);\n            const firestore = getFirestore(app);\n            const authentication = getAuth(app);\n            \n            setDb(firestore);\n            setAuth(authentication);\n\n            // Listen for auth state changes\n            const unsubscribe = onAuthStateChanged(authentication, (user) => {\n                if (user) {\n                    setUserId(user.uid);\n                } else {\n                    // Sign in with custom token if available, otherwise anonymously\n                    (async () => {\n                        try {\n                            if (initialAuthToken) {\n                                await signInWithCustomToken(authentication, initialAuthToken);\n                            } else {\n                                await signInAnonymously(authentication);\n                            }\n                        } catch (e) {\n                            console.error(\"Firebase Auth Error:\", e);\n                            setFirebaseError(`Authentication failed. ${e.message}`);\n                            setUserId('guest-error');\n                        }\n                        setIsAuthReady(true);\n                    })();\n                }\n            });\n\n            return () => unsubscribe();\n        } catch (e) {\n            console.error(\"Firebase Initialization Failed:\", e);\n            setFirebaseError(`Failed to initialize Firebase. ${e.message}`);\n            setIsAuthReady(true);\n        }\n    }, [firebaseConfig, initialAuthToken]); // Runs only once on mount\n\n    // 2. Firestore Real-time Listener (Chat Messages)\n    useEffect(() => {\n        if (!isAuthReady || !db || !userId) return;\n\n        // Query: Get last 50 messages, ordered by timestamp\n        const q = query(\n            collection(db, PUBLIC_COLLECTION_PATH),\n            orderBy('timestamp', 'desc'),\n            limit(50) // Limit to the last 50 messages for performance\n        );\n        \n        const unsubscribe = onSnapshot(q, (snapshot) => {\n            const fetchedMessages = snapshot.docs.map(doc => {\n                const data = doc.data();\n                return {\n                    id: doc.id,\n                    text: data.text,\n                    sender: data.sender,\n                    userId: data.userId,\n                    // Convert Firebase Timestamp to JS Date object for sorting if needed\n                    timestamp: data.timestamp?.toDate ? data.timestamp.toDate() : new Date(),\n                };\n            }).reverse(); // Reverse to display in chronological order\n            \n            setMessages(fetchedMessages);\n        }, (error) => {\n            console.error(\"Firestore Listener Error:\", error);\n            setFirebaseError(`Failed to load chat history. ${error.message}`);\n        });\n\n        // Cleanup the listener on unmount or dependency change\n        return () => unsubscribe();\n    }, [isAuthReady, db, userId]); // Reruns when auth is ready or db/userId changes\n\n    // 3. Scroll to bottom on message update\n    useEffect(() => {\n        scrollToBottom();\n    }, [messages]);\n    \n    // 4. Check TTS/STT capability\n    useEffect(() => {\n        setCanSpeak('speechSynthesis' in window && 'AudioContext' in window);\n        // Note: Speech recognition capability is checked in startListening\n    }, []);\n\n    const lastBotMessage = messages.slice().reverse().find(msg => msg.sender === 'bot');\n    \n    if (firebaseError) {\n        return (\n            <div className=\"p-8 bg-red-100 border border-red-400 text-red-700 rounded-lg max-w-md mx-auto my-12\">\n                <h2 className=\"text-xl font-bold mb-2\">Application Error</h2>\n                <p>{firebaseError}</p>\n                <p className=\"mt-4 text-sm\">Please check your Firebase configuration and network connection.</p>\n            </div>\n        );\n    }\n\n    if (!isAuthReady) {\n        return (\n            <div className=\"p-8 bg-white rounded-xl shadow-lg max-w-md mx-auto my-12 text-center\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto\"></div>\n                <p className=\"mt-4 text-gray-600\">Connecting to Firebase and authenticating...</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"w-full max-w-md h-[80vh] bg-white rounded-xl flex flex-col overflow-hidden border-2 border-gray-200 shadow-2xl\">\n            \n            {/* Chat Header */}\n            <div className=\"bg-primary text-white p-3 text-lg font-extrabold flex justify-between items-center\">\n                <div className=\"flex items-center gap-2\">\n                    ðŸ¤– Mene AI Chatbot\n                </div>\n                {/* Displaying User ID is MANDATORY for collaborative apps */}\n                <span className=\"text-xs bg-white text-primary px-2 py-1 rounded-full font-medium\">\n                    User: {userId}\n                </span>\n            </div>\n\n            {/* Messages Container */}\n            <div className=\"messages-container flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50\">\n                {messages.length === 0 && (\n                    <div className=\"text-center text-gray-500 italic pt-10\">\n                        Start a conversation! Your messages will be shared publicly.\n                    </div>\n                )}\n                {messages.map((msg) => (\n                    <div \n                        key={msg.id} \n                        // Message Styling based on sender\n                        className={`max-w-[75%] p-3 rounded-xl shadow transition-all duration-300 ${\n                            msg.sender === 'user' \n                            ? 'ml-auto bg-blue-500 text-white rounded-br-none' \n                            : msg.sender === 'bot' \n                            ? 'mr-auto bg-gray-200 text-gray-800 rounded-tl-none hover:shadow-lg' \n                            : 'mx-auto bg-yellow-100 text-gray-700 text-sm' // System message\n                        }`}\n                        // Enable TTS click only for bot messages when capable\n                        onClick={msg.sender === \"bot\" && canSpeak ? () => handleSpeak(msg.text) : null}\n                        title={msg.sender === \"bot\" && canSpeak ? \"Click to hear this message\" : null}\n                    >\n                        <div className=\"text-xs font-semibold mb-1 opacity-70\">\n                            {msg.sender === 'user' ? 'You' : msg.sender === 'bot' ? 'Mene Bot' : 'System'}\n                        </div>\n                        {msg.text}\n                    </div>\n                ))}\n\n                {/* Typing Indicator */}\n                {isTyping && (\n                    <div className=\"mr-auto p-3 rounded-xl rounded-tl-none bg-gray-200 text-gray-500 italic shadow max-w-xs\">\n                         Mene is generating...\n                    </div>\n                )}\n\n                <div ref={messageEndRef} />\n            </div>\n\n            {/* Input Area */}\n            <div className=\"p-3 flex gap-2 border-t border-gray-200 bg-white items-center\">\n                \n                {/* Voice Input Button */}\n                <button \n                    className={`p-3 rounded-full text-white transition duration-300 ${\n                        isListening \n                        ? 'bg-red-500 animate-pulse' \n                        : isTyping \n                        ? 'bg-gray-400 cursor-not-allowed'\n                        : 'bg-primary hover:bg-secondary'\n                    }`}\n                    onClick={startListening}\n                    disabled={isTyping}\n                    title={isListening ? \"Stop listening\" : \"Start voice input\"}\n                >\n                    ðŸŽ¤\n                </button>\n\n                {/* Text Input Field */}\n                <input\n                    type=\"text\"\n                    value={input}\n                    onChange={(e) => setInput(e.target.value)}\n                    onKeyDown={(e) => e.key === \"Enter\" && handleSend()}\n                    placeholder={isListening ? \"Speak now...\" : \"Ask Mene anything...\"}\n                    className=\"flex-1 p-3 rounded-full border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition duration-150\"\n                    disabled={isTyping}\n                />\n                \n                {/* Speaker button to play the last bot message */}\n                <button \n                    className={`p-3 rounded-full text-white transition duration-300 ${\n                        !lastBotMessage?.text || isTyping || !canSpeak\n                        ? 'bg-gray-400 cursor-not-allowed'\n                        : 'bg-primary hover:bg-secondary'\n                    }`}\n                    onClick={() => handleSpeak(lastBotMessage?.text)}\n                    disabled={isTyping || !lastBotMessage?.text || !canSpeak}\n                    title=\"Read last bot message aloud\"\n                >\n                    ðŸ”Š\n                </button>\n\n                {/* Send Button */}\n                <button \n                    className={`p-3 px-4 rounded-full text-white font-bold transition duration-300 ${\n                        isTyping || !input.trim()\n                        ? 'bg-gray-400 cursor-not-allowed'\n                        : 'bg-primary hover:bg-secondary'\n                    }`}\n                    onClick={() => handleSend()} \n                    disabled={isTyping || !input.trim()}\n                >\n                    Send\n                </button>\n            </div>\n        </div>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}