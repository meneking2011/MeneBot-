{"ast":null,"code":"import _objectSpread from\"/workspaces/MeneBot-/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncIterator from\"/workspaces/MeneBot-/node_modules/@babel/runtime/helpers/esm/asyncIterator.js\";import React,{useState,useEffect,useRef,useCallback}from\"react\";import{v4 as uuidv4}from'uuid';// --- FIREBASE IMPORTS ---\nimport{initializeApp}from'firebase/app';import{getAuth,signInAnonymously,signInWithCustomToken,onAuthStateChanged}from'firebase/auth';import{getFirestore,collection,query,onSnapshot,addDoc,orderBy,limit,serverTimestamp,setLogLevel,doc,deleteDoc,where,writeBatch,getDocs,setDoc}from'firebase/firestore';// --- ENVIRONMENT VARIABLE HANDLING ---\n// Variables injected by the Canvas environment for secure setup.\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const appId=typeof __app_id!=='undefined'?__app_id:'default-app-id';const firebaseConfig=typeof __firebase_config!=='undefined'?JSON.parse(__firebase_config):null;const initialAuthToken=typeof __initial_auth_token!=='undefined'?__initial_auth_token:null;// --- API and TTS/STT Helper Functions ---\n// 1. API Key Getter\nconst getApiKey=()=>{// Check for the secure, environment-provided key first\nif(typeof __api_key!=='undefined'){return __api_key;}// Fallback: Use an empty string if running locally without the Canvas environment.\nreturn'';};const GEMINI_API_KEY=getApiKey();const MODEL_NAME='gemini-2.5-flash-preview-09-2025';const API_ENDPOINT=\"https://generativelanguage.googleapis.com/v1beta/models/\".concat(MODEL_NAME,\":generateContent?key=\").concat(GEMINI_API_KEY);const TTS_API_ENDPOINT=\"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=\".concat(GEMINI_API_KEY);// 2. Gemini Stream Simulation\n/**\n * Creates an Async Iterator that handles the AI request and simulates a stream.\n */export function askAIStream(inputText,chatHistory){let fullResponse=null;let chunks=[];let chunkIndex=0;const historyForAPI=chatHistory.map(msg=>({role:msg.sender==='user'?'user':'model',parts:[{text:msg.text}]}));// Manually implements the async iterator protocol\nreturn{async next(){try{// First call: make the REST API request\nif(fullResponse===null){var _data$candidates,_data$candidates$,_data$candidates$$con,_data$candidates$$con2,_data$candidates$$con3;const payload={contents:[...historyForAPI,{role:'user',parts:[{text:inputText}]}],systemInstruction:{parts:[{text:\"You are Mene, a helpful and friendly AI assistant. Keep your responses concise.\"}]}};const response=await fetch(API_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(!response.ok){var _errorDetails$error;const errorDetails=await response.json();throw new Error(\"\".concat(response.status,\" \").concat(response.statusText,\": \").concat(((_errorDetails$error=errorDetails.error)===null||_errorDetails$error===void 0?void 0:_errorDetails$error.message)||'Unknown API Error'));}const data=await response.json();// Extract the text from the API's response structure\nfullResponse=((_data$candidates=data.candidates)===null||_data$candidates===void 0?void 0:(_data$candidates$=_data$candidates[0])===null||_data$candidates$===void 0?void 0:(_data$candidates$$con=_data$candidates$.content)===null||_data$candidates$$con===void 0?void 0:(_data$candidates$$con2=_data$candidates$$con.parts)===null||_data$candidates$$con2===void 0?void 0:(_data$candidates$$con3=_data$candidates$$con2[0])===null||_data$candidates$$con3===void 0?void 0:_data$candidates$$con3.text)||\"No response received from AI.\";// Split the full response to simulate the streaming effect\n// Splits by word and preserves spaces for better visual flow\nchunks=fullResponse.split(/(\\s+)/).filter(c=>c.length>0);}// Subsequent calls: Stream out the chunks one by one\nif(chunkIndex>=chunks.length){return{done:true,value:fullResponse};// Return full response on finish\n}// Small delay to simulate streaming visually\nawait new Promise(r=>setTimeout(r,20));const chunk=chunks[chunkIndex++];return{value:chunk,done:false};}catch(error){console.error(\"Gemini API Error:\",error);// Return a user-friendly error message\nreturn{value:\"ERROR: Failed to connect to AI. Details: \".concat(error.message),done:true};}},[Symbol.asyncIterator](){return this;}};}// 3. TTS Utility Functions\n/**\n * Converts a base64 string to an ArrayBuffer.\n */const base64ToArrayBuffer=base64=>{const binaryString=atob(base64);const len=binaryString.length;const bytes=new Uint8Array(len);for(let i=0;i<len;i++){bytes[i]=binaryString.charCodeAt(i);}return bytes.buffer;};/**\n * Converts PCM (raw audio data) to a standard WAV format Blob.\n * @param {Int16Array} pcm16 - 16-bit PCM audio data.\n * @param {number} sampleRate - Sample rate of the audio (e.g., 24000).\n * @returns {Blob} - A Blob containing the WAV file data.\n */const pcmToWav=(pcm16,sampleRate)=>{const numChannels=1;const numSamples=pcm16.length;const byteRate=sampleRate*numChannels*2;// 2 bytes per sample (16 bit)\nconst blockAlign=numChannels*2;const buffer=new ArrayBuffer(44+pcm16.byteLength);const view=new DataView(buffer);// RIFF identifier 'RIFF'\nwriteString(view,0,'RIFF');// RIFF chunk length\nview.setUint32(4,36+pcm16.byteLength,true);// WAVE identifier 'WAVE'\nwriteString(view,8,'WAVE');// format chunk identifier 'fmt '\nwriteString(view,12,'fmt ');// format chunk length \nview.setUint32(16,16,true);// sample format (1 for PCM)\nview.setUint16(20,1,true);// number of channels\nview.setUint16(22,numChannels,true);// sample rate\nview.setUint32(24,sampleRate,true);// byte rate\nview.setUint32(28,byteRate,true);// block align\nview.setUint16(32,blockAlign,true);// bits per sample\nview.setUint16(34,16,true);// data chunk identifier 'data'\nwriteString(view,36,'data');// data chunk length\nview.setUint32(40,pcm16.byteLength,true);// PCM data\nconst pcmView=new Int16Array(buffer,44);pcmView.set(pcm16);return new Blob([buffer],{type:'audio/wav'});};/**\n * Writes a string to a DataView at a specified offset.\n */const writeString=(view,offset,string)=>{for(let i=0;i<string.length;i++){view.setUint8(offset+i,string.charCodeAt(i));}};/**\n * Makes the TTS API call and returns an Audio URL.\n */const ttsApiCall=async(text,setErrorMessage)=>{if(!text)return null;try{var _result$candidates,_result$candidates$,_result$candidates$$c,_result$candidates$$c2,_part$inlineData,_part$inlineData2;const payload={contents:[{parts:[{text:text}]}],generationConfig:{responseModalities:[\"AUDIO\"],speechConfig:{voiceConfig:{// Using a clear, friendly voice\nprebuiltVoiceConfig:{voiceName:\"Achird\"}}}}};const response=await fetch(TTS_API_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(!response.ok){throw new Error(\"TTS API failed with status \".concat(response.status));}const result=await response.json();const part=result===null||result===void 0?void 0:(_result$candidates=result.candidates)===null||_result$candidates===void 0?void 0:(_result$candidates$=_result$candidates[0])===null||_result$candidates$===void 0?void 0:(_result$candidates$$c=_result$candidates$.content)===null||_result$candidates$$c===void 0?void 0:(_result$candidates$$c2=_result$candidates$$c.parts)===null||_result$candidates$$c2===void 0?void 0:_result$candidates$$c2[0];const audioData=part===null||part===void 0?void 0:(_part$inlineData=part.inlineData)===null||_part$inlineData===void 0?void 0:_part$inlineData.data;const mimeType=part===null||part===void 0?void 0:(_part$inlineData2=part.inlineData)===null||_part$inlineData2===void 0?void 0:_part$inlineData2.mimeType;if(audioData&&mimeType&&mimeType.startsWith(\"audio/L16\")){// Extract sample rate from mimeType, e.g., audio/L16;rate=24000\nconst rateMatch=mimeType.match(/rate=(\\d+)/);const sampleRate=rateMatch?parseInt(rateMatch[1],10):24000;const pcmData=base64ToArrayBuffer(audioData);const pcm16=new Int16Array(pcmData);const wavBlob=pcmToWav(pcm16,sampleRate);return URL.createObjectURL(wavBlob);}else{setErrorMessage(\"TTS Error: Could not generate valid audio data.\");return null;}}catch(error){console.error(\"TTS Fetch Error:\",error);setErrorMessage(\"TTS Generation failed: \".concat(error.message));return null;}};// 4. Speech Recognition (STT) Utility\nlet recognition=null;const setupRecognition=onResult=>{// Check for browser compatibility (webkitSpeechRecognition is the most common implementation)\nif('webkitSpeechRecognition'in window){// We must use `window.webkitSpeechRecognition` as standard `SpeechRecognition` might not be available\nrecognition=new window.webkitSpeechRecognition();recognition.continuous=false;recognition.interimResults=false;recognition.lang='en-US';recognition.onresult=event=>{const transcript=event.results[0][0].transcript;onResult(transcript);};recognition.onerror=event=>{console.error('Speech recognition error:',event.error);};recognition.onend=()=>{console.log('Speech recognition ended.');setIsListening(false);// Make sure to update state on end/error\n};return true;}return false;};// 5. Common Collection Paths\nconst SESSIONS_COLLECTION_PATH=\"/artifacts/\".concat(appId,\"/users\");const MESSAGES_COLLECTION_PATH=(userId,sessionId)=>\"/artifacts/\".concat(appId,\"/users/\").concat(userId,\"/sessions/\").concat(sessionId,\"/messages\");// --- UI Components (Defined locally for single-file mandate) ---\nconst Sidebar=/*#__PURE__*/React.memo(_ref=>{let{sessions,currentSessionId,switchSession,createNewSession,deleteSession,userId}=_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"w-full md:w-64 bg-gray-50 border-r border-gray-200 p-4 flex flex-col transition-all duration-300\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-xl font-bold text-gray-800 mb-4 flex items-center justify-between\",children:[\"Conversations\",/*#__PURE__*/_jsx(\"button\",{onClick:createNewSession,className:\"p-2 bg-green-500 text-white rounded-full hover:bg-green-600 transition duration-150 shadow-md\",title:\"New Chat\",children:\"+\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-y-auto space-y-2\",children:sessions.map(session=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-3 rounded-lg cursor-pointer transition duration-150 \".concat(session.id===currentSessionId?'bg-green-100 text-green-700 font-semibold':'bg-white text-gray-700 hover:bg-gray-100'),onClick:()=>switchSession(session.id),children:[/*#__PURE__*/_jsx(\"span\",{className:\"truncate flex-1\",children:session.name||\"New Chat\"}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();deleteSession(session.id);},className:\"text-red-500 p-1 hover:text-red-700 rounded-full transition duration-150 ml-2\",title:\"Delete Chat\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-4 w-4\",viewBox:\"0 0 20 20\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 100 2v6a1 1 0 100-2V8z\",clipRule:\"evenodd\"})})})]},session.id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 pt-4 border-t border-gray-200 text-sm text-gray-500\",children:[\"User ID: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-mono text-xs\",children:userId?\"\".concat(userId.substring(0,8),\"...\"):\"N/A\"})]})]});});// --- Main App Component ---\nexport default function App(){// --- Firebase State ---\nconst[db,setDb]=useState(null);const[auth,setAuth]=useState(null);const[userId,setUserId]=useState(null);const[isAuthReady,setIsAuthReady]=useState(false);const[sessions,setSessions]=useState([]);const[currentSessionId,setCurrentSessionId]=useState(null);// --- Chat State ---\nconst[messages,setMessages]=useState([]);const[input,setInput]=useState(\"\");const[isTyping,setIsTyping]=useState(false);const[errorMessage,setErrorMessage]=useState(null);const messageEndRef=useRef(null);const[isSidebarOpen,setIsSidebarOpen]=useState(window.innerWidth>=768);// Open by default on desktop\n// --- TTS/STT State ---\nconst[canSpeak,setCanSpeak]=useState(false);const[isListening,setIsListening]=useState(false);const[lastBotMessage,setLastBotMessage]=useState(null);const recognitionRef=useRef(null);// Ref for speech recognition instance\n// --- Effects ---\n// 1. Initialize Firebase and Authentication\nuseEffect(()=>{if(firebaseConfig){try{const app=initializeApp(firebaseConfig);const firestore=getFirestore(app);const authentication=getAuth(app);// Enable debug logging for better development visibility\nsetLogLevel('debug');setDb(firestore);setAuth(authentication);const unsubscribeAuth=onAuthStateChanged(authentication,async user=>{var _authentication$curre;if(!user){console.log(\"No user signed in. Attempting sign-in...\");try{// If custom token is available, use it; otherwise, sign in anonymously\nif(initialAuthToken){await signInWithCustomToken(authentication,initialAuthToken);}else{await signInAnonymously(authentication);}}catch(e){console.error(\"Firebase Auth Error:\",e);setErrorMessage(\"Failed to authenticate with Firebase.\");}}// Auth state has stabilized, user is set (anonymous or custom token)\nsetUserId(((_authentication$curre=authentication.currentUser)===null||_authentication$curre===void 0?void 0:_authentication$curre.uid)||crypto.randomUUID());setIsAuthReady(true);});return()=>unsubscribeAuth();}catch(e){console.error(\"Firebase Init Error:\",e);setErrorMessage(\"Failed to initialize Firebase services.\");}}},[firebaseConfig,initialAuthToken]);// 2. Setup Sessions Listener\nuseEffect(()=>{if(!isAuthReady||!db||!userId)return;const userSessionsRef=collection(db,SESSIONS_COLLECTION_PATH,userId,'sessions');const q=query(userSessionsRef,orderBy('createdAt','desc'));const unsubscribe=onSnapshot(q,snapshot=>{const loadedSessions=snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setSessions(loadedSessions);// If no sessions exist, create a new one automatically\nif(loadedSessions.length===0){// Use a timeout to ensure state updates happen after listener setup\nsetTimeout(()=>createSession(userId),0);}else if(!currentSessionId||!loadedSessions.find(s=>s.id===currentSessionId)){// Set to the most recent session if current one is invalid or deleted\nsetCurrentSessionId(loadedSessions[0].id);}},error=>{console.error(\"Firestore Sessions Error:\",error);setErrorMessage(\"Failed to fetch chat sessions.\");});return()=>unsubscribe();},[isAuthReady,db,userId,currentSessionId]);// Dependency on currentSessionId is required to re-evaluate logic when it changes\n// 3. Setup Messages Listener (Current Session)\nuseEffect(()=>{if(!isAuthReady||!db||!userId||!currentSessionId){setMessages([]);// Clear messages if no session is selected\nreturn;}const messagesRef=collection(db,MESSAGES_COLLECTION_PATH(userId,currentSessionId));// Query last 50 messages, ordered by time\nconst q=query(messagesRef,orderBy('createdAt','asc'),limit(50));const unsubscribe=onSnapshot(q,snapshot=>{const loadedMessages=snapshot.docs.map(doc=>{var _data$createdAt;const data=doc.data();return{id:doc.id,sender:data.sender,text:data.text,// Handle Firestore Timestamp conversion\ncreatedAt:(_data$createdAt=data.createdAt)!==null&&_data$createdAt!==void 0&&_data$createdAt.toDate?data.createdAt.toDate():new Date()};});setMessages(loadedMessages);// Track the last bot message for the TTS button\nconst lastBot=loadedMessages.slice().reverse().find(msg=>msg.sender==='bot');setLastBotMessage(lastBot);},error=>{console.error(\"Firestore Messages Error:\",error);setErrorMessage(\"Failed to fetch chat messages.\");});return()=>unsubscribe();},[isAuthReady,db,userId,currentSessionId]);// 4. Scroll to bottom on new messages/typing\nuseEffect(()=>{var _messageEndRef$curren;(_messageEndRef$curren=messageEndRef.current)===null||_messageEndRef$curren===void 0?void 0:_messageEndRef$curren.scrollIntoView({behavior:\"smooth\"});},[messages,isTyping]);// 5. Check for TTS/STT capability and setup STT\nuseEffect(()=>{if('speechSynthesis'in window&&'webkitSpeechRecognition'in window){setCanSpeak(true);}// Setup the recognition object\nif('webkitSpeechRecognition'in window){const recognitionInstance=new window.webkitSpeechRecognition();recognitionInstance.continuous=false;recognitionInstance.interimResults=false;recognitionInstance.lang='en-US';recognitionInstance.onend=()=>setIsListening(false);recognitionInstance.onerror=event=>{console.error('Speech recognition error:',event.error);setErrorMessage(\"Speech recognition error: \".concat(event.error));setIsListening(false);};recognitionRef.current=recognitionInstance;}// Cleanup on unmount\nreturn()=>{if(recognitionRef.current){recognitionRef.current.stop();recognitionRef.current=null;}};},[]);// --- Firebase Actions ---\nconst switchSession=useCallback(sessionId=>{setCurrentSessionId(sessionId);if(window.innerWidth<768){setIsSidebarOpen(false);// Close sidebar on mobile after selection\n}},[]);const createSession=useCallback(async()=>{if(!db||!userId)return;try{const userSessionsRef=collection(db,SESSIONS_COLLECTION_PATH,userId,'sessions');const newDocRef=doc(userSessionsRef);// Generate a placeholder name\nconst placeholderName=\"Chat \".concat(sessions.length+1);await setDoc(newDocRef,{name:placeholderName,createdAt:serverTimestamp()});setCurrentSessionId(newDocRef.id);if(window.innerWidth<768){setIsSidebarOpen(false);// Close sidebar on mobile\n}}catch(e){console.error(\"Error creating new session:\",e);setErrorMessage(\"Failed to create a new session.\");}},[db,userId,sessions]);const deleteSession=async sessionId=>{if(!db||!userId)return;// Using a custom modal/confirmation dialog is recommended, but using window.confirm\n// temporarily for simplicity in this single file.\nif(!window.confirm(\"Are you sure you want to delete this chat session and all its messages?\")){return;}try{const sessionDocRef=doc(db,SESSIONS_COLLECTION_PATH,userId,'sessions',sessionId);const messagesRef=collection(db,MESSAGES_COLLECTION_PATH(userId,sessionId));const batch=writeBatch(db);// 1. Delete all messages within the session (this requires finding them first)\nconst messageDocs=await getDocs(messagesRef);messageDocs.forEach(msgDoc=>{batch.delete(msgDoc.ref);});// 2. Delete the session document itself\nbatch.delete(sessionDocRef);await batch.commit();// After deletion, find a new session to switch to or create a new one\nif(currentSessionId===sessionId){const remainingSessions=sessions.filter(s=>s.id!==sessionId);if(remainingSessions.length>0){setCurrentSessionId(remainingSessions[0].id);}else{setCurrentSessionId(null);// Use a slight delay to ensure the listener picks up the deletion before creation\nsetTimeout(()=>createSession(),100);}}}catch(e){console.error(\"Error deleting session:\",e);setErrorMessage(\"Failed to delete the chat session.\");}};// --- TTS/STT Handlers ---\nconst handleSpeak=useCallback(async text=>{if(!canSpeak||!text)return;// Clear previous error message\nsetErrorMessage(null);const audioUrl=await ttsApiCall(text,setErrorMessage);if(audioUrl){const audio=new Audio(audioUrl);audio.play();}},[canSpeak]);const handleSend=useCallback(async function(){let transcript=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;const textToSend=(transcript||input).trim();if(isTyping||!textToSend||!currentSessionId)return;setErrorMessage(null);setIsTyping(true);setInput(\"\");// 1. Save user message immediately\nawait saveMessage(\"user\",textToSend);// 2. Stream and accumulate bot response\nlet accumulatedBotText=\"\";// Use the current messages state to construct history for the AI\nconst historyForAI=messages.map(msg=>({sender:msg.sender,text:msg.text}));const stream=askAIStream(textToSend,historyForAI);// Create a temporary message placeholder for streaming\nconst tempBotId=uuidv4();setMessages(prev=>[...prev,{id:tempBotId,sender:\"bot\",text:\"\"}]);var _iteratorAbruptCompletion=false;var _didIteratorError=false;var _iteratorError;try{for(var _iterator=_asyncIterator(stream),_step;_iteratorAbruptCompletion=!(_step=await _iterator.next()).done;_iteratorAbruptCompletion=false){const chunk=_step.value;{accumulatedBotText+=chunk;// Update the temporary message with the streamed content\nsetMessages(prev=>prev.map(msg=>msg.id===tempBotId?_objectSpread(_objectSpread({},msg),{},{text:accumulatedBotText}):msg));// Break if the stream returned an error\nif(accumulatedBotText.includes(\"ERROR:\"))break;}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(_iteratorAbruptCompletion&&_iterator.return!=null){await _iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}setIsTyping(false);// 3. Persist the final bot message (and remove the temporary one)\nif(!accumulatedBotText.includes(\"ERROR:\")){// Find the session document reference\nconst sessionDocRef=doc(db,SESSIONS_COLLECTION_PATH,userId,'sessions',currentSessionId);// Update the session name with the first question if it's the first message\n// Note: This check relies on the *local* messages array before the final message is saved.\nif(messages.length===0){const sessionName=textToSend.substring(0,30)+(textToSend.length>30?'...':'');await setDoc(sessionDocRef,{name:sessionName},{merge:true});}// Save final bot message\nawait saveMessage(\"bot\",accumulatedBotText);// The Firestore onSnapshot listener will handle the final state update, \n// removing the need to manually delete the temporary message here.\n}else{// If error, keep the error message in the local state but do not persist it to Firestore\n// The error message is already rendered via the streaming loop.\n}},[input,isTyping,currentSessionId,db,userId,messages]);const startListening=useCallback(()=>{if(isTyping||!recognitionRef.current)return;setErrorMessage(null);const recognitionInstance=recognitionRef.current;recognitionInstance.onresult=event=>{const transcript=event.results[0][0].transcript;setInput(transcript);recognitionInstance.stop();// Manually stop after getting result\nhandleSend(transcript);// Auto-send the transcribed text\n};try{recognitionInstance.start();setIsListening(true);}catch(e){// Error code 11 is typically \"already started\"\nif(e.name!=='InvalidStateError'){console.error(\"STT Start Error:\",e);setErrorMessage(\"Speech recognition failed to start. Browser support required.\");setIsListening(false);}}},[isTyping,handleSend]);// --- Chat Logic ---\nconst saveMessage=async(sender,text)=>{if(!db||!userId||!currentSessionId||!text)return;try{const messagesRef=collection(db,MESSAGES_COLLECTION_PATH(userId,currentSessionId));await addDoc(messagesRef,{sender:sender,text:text,createdAt:serverTimestamp()});}catch(e){console.error(\"Error saving message:\",e);setErrorMessage(\"Failed to save message to database.\");}};// --- Render Logic ---\nif(!isAuthReady){return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center min-h-screen text-gray-600 bg-gray-100\",children:/*#__PURE__*/_jsx(\"div\",{className:\"p-6 bg-white rounded-xl shadow-lg\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Loading application and authenticating...\"})})});}// Header component\nconst Header=()=>{var _sessions$find;return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-green-600 text-white shadow-md flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"md:hidden p-1 rounded-md hover:bg-green-700 transition\",onClick:()=>setIsSidebarOpen(!isSidebarOpen),title:\"Toggle Sidebar\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-6 w-6\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M4 6h16M4 12h16m-7 6h7\"})})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl font-bold flex-1 text-center md:text-left\",children:\"Mene AI Chatbot\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"hidden md:block text-sm opacity-80 bg-green-700 px-3 py-1 rounded-full\",children:[\"Session: \",((_sessions$find=sessions.find(s=>s.id===currentSessionId))===null||_sessions$find===void 0?void 0:_sessions$find.name)||\"New Chat\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"hidden md:block text-xs font-mono opacity-60 ml-4\",children:[\"User ID: \",userId.substring(0,8),\"...\"]})]});};// Main Chat Content\nconst chatContent=/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 flex flex-col min-w-0 bg-white\",children:[/*#__PURE__*/_jsx(Header,{}),errorMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-red-100 text-red-700 text-sm text-center font-medium border-l-4 border-red-500\",children:errorMessage}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 p-4 space-y-4 overflow-y-auto custom-scrollbar\",children:[messages.map(msg=>/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(msg.sender===\"user\"?\"justify-end\":\"justify-start\"),children:/*#__PURE__*/_jsx(\"div\",{// Tailwind classes for speech bubbles\nclassName:\"max-w-xs md:max-w-md lg:max-w-lg p-3 rounded-xl shadow-md text-sm \".concat(msg.sender===\"user\"?\"bg-blue-500 text-white rounded-br-none\":\"bg-gray-200 text-gray-800 rounded-tl-none\"),onClick:msg.sender===\"bot\"&&canSpeak?()=>handleSpeak(msg.text):null,style:msg.sender===\"bot\"&&canSpeak?{cursor:'pointer'}:{},title:msg.sender===\"bot\"&&canSpeak?\"Click to hear this message\":null,children:msg.text})},msg.id)),isTyping&&/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-start\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-xs p-3 rounded-xl bg-gray-100 text-gray-500 italic text-sm shadow-sm\",children:\"Mene is generating...\"})}),/*#__PURE__*/_jsx(\"div\",{ref:messageEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 border-t border-gray-200 flex items-center space-x-2 bg-gray-50\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"p-3 rounded-full transition duration-150 shadow-md \".concat(isListening?'bg-red-500 text-white animate-pulse':'bg-gray-300 text-gray-700 hover:bg-gray-400'),onClick:startListening,disabled:isTyping,title:isListening?\"Listening...\":\"Start voice input (STT)\",children:/*#__PURE__*/_jsxs(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-5 w-5\",viewBox:\"0 0 20 20\",fill:\"currentColor\",children:[/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4z\",clipRule:\"evenodd\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M5.5 9.5a.5.5 0 011 0v4a.5.5 0 01-1 0v-4zM13.5 9.5a.5.5 0 011 0v4a.5.5 0 01-1 0v-4z\"}),/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M10 18a.75.75 0 01-.75-.75V15a.75.75 0 011.5 0v2.25A.75.75 0 0110 18zm6.5-6.5a.5.5 0 01-1 0v-4a.5.5 0 011 0v4zM3.5 11.5a.5.5 0 011 0v-4a.5.5 0 01-1 0v4z\",clipRule:\"evenodd\"}),/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M5 9.75a.75.75 0 01.75-.75h8.5a.75.75 0 010 1.5H5.75A.75.75 0 015 9.75z\",clipRule:\"evenodd\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M15 11a1 1 0 011 1v2a4 4 0 01-8 0v-2a1 1 0 011-1h6z\"})]})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:input,onChange:e=>setInput(e.target.value),onKeyDown:e=>e.key===\"Enter\"&&handleSend(),placeholder:\"Ask Mene anything...\",disabled:isTyping,className:\"flex-1 p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150\"}),/*#__PURE__*/_jsx(\"button\",{className:\"p-3 rounded-full transition duration-150 shadow-md \".concat(canSpeak&&!isTyping&&lastBotMessage?'bg-green-500 text-white hover:bg-green-600':'bg-gray-300 text-gray-500 cursor-not-allowed'),onClick:()=>handleSpeak(lastBotMessage===null||lastBotMessage===void 0?void 0:lastBotMessage.text),disabled:isTyping||!canSpeak||!lastBotMessage,title:\"Read last bot message aloud (TTS)\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-5 w-5\",viewBox:\"0 0 20 20\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M9.383 3.003c.125-.466.52-.803.955-.803h.305c.435 0 .83.337.955.803l.36 1.353a1.5 1.5 0 001.037.989l.254.053c1.685.356 2.5 1.776 2.5 3.328v2.96c0 1.552-.815 2.972-2.5 3.328l-.254.053a1.5 1.5 0 00-1.037.989l-.36 1.353c-.125.466-.52.803-.955.803h-.305c-.435 0-.83-.337-.955-.803l-.36-1.353a1.5 1.5 0 00-1.037-.989l-.254-.053c-1.685-.356-2.5-1.776-2.5-3.328v-2.96c0-1.552.815-2.972 2.5-3.328l.254-.053a1.5 1.5 0 001.037-.989l.36-1.353zM10 7a1 1 0 100 2 1 1 0 000-2zm0 4a1 1 0 100 2 1 1 0 000-2z\",clipRule:\"evenodd\"})})}),/*#__PURE__*/_jsx(\"button\",{className:\"p-3 rounded-full transition duration-150 shadow-md \".concat(isTyping||!input.trim()?'bg-gray-300 text-gray-500 cursor-not-allowed':'bg-green-500 text-white hover:bg-green-600'),onClick:()=>handleSend(),disabled:isTyping||!input.trim(),title:\"Send Message\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-5 w-5\",viewBox:\"0 0 20 20\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l4.47-1.405 6.447 3.376a1 1 0 00.999 0l6.447-3.376 4.47 1.405a1 1 0 001.169-1.409l-7-14z\"})})})]})]});// Final Application Layout (Desktop/Mobile Responsive)\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-0 md:p-4 font-inter\",children:[/*#__PURE__*/_jsx(\"style\",{jsx:\"true\",children:\"\\n                /* Custom scrollbar for message area */\\n                .custom-scrollbar::-webkit-scrollbar {\\n                    width: 8px;\\n                }\\n                .custom-scrollbar::-webkit-scrollbar-track {\\n                    background: #f1f1f1;\\n                }\\n                .custom-scrollbar::-webkit-scrollbar-thumb {\\n                    background: #ccc;\\n                    border-radius: 10px;\\n                }\\n                .custom-scrollbar::-webkit-scrollbar-thumb:hover {\\n                    background: #999;\\n                }\\n            \"}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full h-screen md:w-full md:max-w-6xl md:h-[90vh] flex bg-white md:rounded-xl shadow-2xl overflow-hidden transition-all duration-300\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"fixed inset-0 z-40 md:static md:z-auto \".concat(isSidebarOpen?'translate-x-0':'-translate-x-full',\" md:translate-x-0 transition-transform duration-300 w-64 flex-shrink-0\"),children:[/*#__PURE__*/_jsx(Sidebar,{sessions:sessions,currentSessionId:currentSessionId,switchSession:switchSession,createNewSession:createSession,deleteSession:deleteSession,userId:userId}),isSidebarOpen&&window.innerWidth<768&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 bg-black opacity-50 md:hidden z-30\",onClick:()=>setIsSidebarOpen(false)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 flex flex-col min-w-0 z-10\",children:chatContent})]})]});}","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","v4","uuidv4","initializeApp","getAuth","signInAnonymously","signInWithCustomToken","onAuthStateChanged","getFirestore","collection","query","onSnapshot","addDoc","orderBy","limit","serverTimestamp","setLogLevel","doc","deleteDoc","where","writeBatch","getDocs","setDoc","jsx","_jsx","jsxs","_jsxs","appId","__app_id","firebaseConfig","__firebase_config","JSON","parse","initialAuthToken","__initial_auth_token","getApiKey","__api_key","GEMINI_API_KEY","MODEL_NAME","API_ENDPOINT","concat","TTS_API_ENDPOINT","askAIStream","inputText","chatHistory","fullResponse","chunks","chunkIndex","historyForAPI","map","msg","role","sender","parts","text","next","_data$candidates","_data$candidates$","_data$candidates$$con","_data$candidates$$con2","_data$candidates$$con3","payload","contents","systemInstruction","response","fetch","method","headers","body","stringify","ok","_errorDetails$error","errorDetails","json","Error","status","statusText","error","message","data","candidates","content","split","filter","c","length","done","value","Promise","r","setTimeout","chunk","console","Symbol","asyncIterator","base64ToArrayBuffer","base64","binaryString","atob","len","bytes","Uint8Array","i","charCodeAt","buffer","pcmToWav","pcm16","sampleRate","numChannels","numSamples","byteRate","blockAlign","ArrayBuffer","byteLength","view","DataView","writeString","setUint32","setUint16","pcmView","Int16Array","set","Blob","type","offset","string","setUint8","ttsApiCall","setErrorMessage","_result$candidates","_result$candidates$","_result$candidates$$c","_result$candidates$$c2","_part$inlineData","_part$inlineData2","generationConfig","responseModalities","speechConfig","voiceConfig","prebuiltVoiceConfig","voiceName","result","part","audioData","inlineData","mimeType","startsWith","rateMatch","match","parseInt","pcmData","wavBlob","URL","createObjectURL","recognition","setupRecognition","onResult","window","webkitSpeechRecognition","continuous","interimResults","lang","onresult","event","transcript","results","onerror","onend","log","setIsListening","SESSIONS_COLLECTION_PATH","MESSAGES_COLLECTION_PATH","userId","sessionId","Sidebar","memo","_ref","sessions","currentSessionId","switchSession","createNewSession","deleteSession","className","children","onClick","title","session","id","name","e","stopPropagation","xmlns","viewBox","fill","fillRule","d","clipRule","substring","App","db","setDb","auth","setAuth","setUserId","isAuthReady","setIsAuthReady","setSessions","setCurrentSessionId","messages","setMessages","input","setInput","isTyping","setIsTyping","errorMessage","messageEndRef","isSidebarOpen","setIsSidebarOpen","innerWidth","canSpeak","setCanSpeak","isListening","lastBotMessage","setLastBotMessage","recognitionRef","app","firestore","authentication","unsubscribeAuth","user","_authentication$curre","currentUser","uid","crypto","randomUUID","userSessionsRef","q","unsubscribe","snapshot","loadedSessions","docs","_objectSpread","createSession","find","s","messagesRef","loadedMessages","_data$createdAt","createdAt","toDate","Date","lastBot","slice","reverse","_messageEndRef$curren","current","scrollIntoView","behavior","recognitionInstance","stop","newDocRef","placeholderName","confirm","sessionDocRef","batch","messageDocs","forEach","msgDoc","delete","ref","commit","remainingSessions","handleSpeak","audioUrl","audio","Audio","play","handleSend","arguments","undefined","textToSend","trim","saveMessage","accumulatedBotText","historyForAI","stream","tempBotId","prev","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_asyncIterator","_step","includes","err","return","sessionName","merge","startListening","start","Header","_sessions$find","stroke","strokeLinecap","strokeLinejoin","strokeWidth","chatContent","style","cursor","disabled","onChange","target","onKeyDown","key","placeholder"],"sources":["/workspaces/MeneBot-/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport { v4 as uuidv4 } from 'uuid';\n\n// --- FIREBASE IMPORTS ---\nimport { \n    initializeApp \n} from 'firebase/app';\nimport { \n    getAuth, \n    signInAnonymously, \n    signInWithCustomToken, \n    onAuthStateChanged,\n} from 'firebase/auth';\nimport { \n    getFirestore, \n    collection, \n    query, \n    onSnapshot, \n    addDoc, \n    orderBy,\n    limit,\n    serverTimestamp,\n    setLogLevel,\n    doc,\n    deleteDoc,\n    where,\n    writeBatch,\n    getDocs,\n    setDoc\n} from 'firebase/firestore';\n\n\n// --- ENVIRONMENT VARIABLE HANDLING ---\n// Variables injected by the Canvas environment for secure setup.\nconst appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\nconst firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\nconst initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\n\n// --- API and TTS/STT Helper Functions ---\n\n// 1. API Key Getter\nconst getApiKey = () => {\n    // Check for the secure, environment-provided key first\n    if (typeof __api_key !== 'undefined') { \n        return __api_key; \n    }\n    // Fallback: Use an empty string if running locally without the Canvas environment.\n    return ''; \n};\n\nconst GEMINI_API_KEY = getApiKey();\nconst MODEL_NAME = 'gemini-2.5-flash-preview-09-2025';\nconst API_ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${GEMINI_API_KEY}`;\nconst TTS_API_ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${GEMINI_API_KEY}`;\n\n\n// 2. Gemini Stream Simulation\n/**\n * Creates an Async Iterator that handles the AI request and simulates a stream.\n */\nexport function askAIStream(inputText, chatHistory) {\n    let fullResponse = null;\n    let chunks = [];\n    let chunkIndex = 0;\n\n    const historyForAPI = chatHistory.map(msg => ({\n        role: msg.sender === 'user' ? 'user' : 'model',\n        parts: [{ text: msg.text }],\n    }));\n\n    // Manually implements the async iterator protocol\n    return {\n        async next() {\n            try {\n                // First call: make the REST API request\n                if (fullResponse === null) {\n                    const payload = {\n                        contents: [...historyForAPI, { role: 'user', parts: [{ text: inputText }] }],\n                        systemInstruction: { parts: [{ text: \"You are Mene, a helpful and friendly AI assistant. Keep your responses concise.\" }] },\n                    };\n\n                    const response = await fetch(API_ENDPOINT, {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json' },\n                        body: JSON.stringify(payload)\n                    });\n\n                    if (!response.ok) {\n                        const errorDetails = await response.json();\n                        throw new Error(`${response.status} ${response.statusText}: ${errorDetails.error?.message || 'Unknown API Error'}`); \n                    }\n                    \n                    const data = await response.json();\n                    \n                    // Extract the text from the API's response structure\n                    fullResponse = data.candidates?.[0]?.content?.parts?.[0]?.text || \"No response received from AI.\";\n                    \n                    // Split the full response to simulate the streaming effect\n                    // Splits by word and preserves spaces for better visual flow\n                    chunks = fullResponse.split(/(\\s+)/).filter(c => c.length > 0); \n                }\n\n                // Subsequent calls: Stream out the chunks one by one\n                if (chunkIndex >= chunks.length) {\n                    return { done: true, value: fullResponse }; // Return full response on finish\n                }\n\n                // Small delay to simulate streaming visually\n                await new Promise((r) => setTimeout(r, 20));\n\n                const chunk = chunks[chunkIndex++];\n                return { value: chunk, done: false };\n\n            } catch (error) {\n                console.error(\"Gemini API Error:\", error);\n                // Return a user-friendly error message\n                return { value: `ERROR: Failed to connect to AI. Details: ${error.message}`, done: true };\n            }\n        },\n        [Symbol.asyncIterator]() {\n            return this;\n        }\n    };\n}\n\n\n// 3. TTS Utility Functions\n\n/**\n * Converts a base64 string to an ArrayBuffer.\n */\nconst base64ToArrayBuffer = (base64) => {\n    const binaryString = atob(base64);\n    const len = binaryString.length;\n    const bytes = new Uint8Array(len);\n    for (let i = 0; i < len; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n    }\n    return bytes.buffer;\n};\n\n/**\n * Converts PCM (raw audio data) to a standard WAV format Blob.\n * @param {Int16Array} pcm16 - 16-bit PCM audio data.\n * @param {number} sampleRate - Sample rate of the audio (e.g., 24000).\n * @returns {Blob} - A Blob containing the WAV file data.\n */\nconst pcmToWav = (pcm16, sampleRate) => {\n    const numChannels = 1;\n    const numSamples = pcm16.length;\n    const byteRate = sampleRate * numChannels * 2; // 2 bytes per sample (16 bit)\n    const blockAlign = numChannels * 2;\n\n    const buffer = new ArrayBuffer(44 + pcm16.byteLength);\n    const view = new DataView(buffer);\n\n    // RIFF identifier 'RIFF'\n    writeString(view, 0, 'RIFF');\n    // RIFF chunk length\n    view.setUint32(4, 36 + pcm16.byteLength, true);\n    // WAVE identifier 'WAVE'\n    writeString(view, 8, 'WAVE');\n    // format chunk identifier 'fmt '\n    writeString(view, 12, 'fmt ');\n    // format chunk length \n    view.setUint32(16, 16, true);\n    // sample format (1 for PCM)\n    view.setUint16(20, 1, true);\n    // number of channels\n    view.setUint16(22, numChannels, true);\n    // sample rate\n    view.setUint32(24, sampleRate, true);\n    // byte rate\n    view.setUint32(28, byteRate, true);\n    // block align\n    view.setUint16(32, blockAlign, true);\n    // bits per sample\n    view.setUint16(34, 16, true);\n    // data chunk identifier 'data'\n    writeString(view, 36, 'data');\n    // data chunk length\n    view.setUint32(40, pcm16.byteLength, true);\n\n    // PCM data\n    const pcmView = new Int16Array(buffer, 44);\n    pcmView.set(pcm16);\n\n    return new Blob([buffer], { type: 'audio/wav' });\n};\n\n/**\n * Writes a string to a DataView at a specified offset.\n */\nconst writeString = (view, offset, string) => {\n    for (let i = 0; i < string.length; i++) {\n        view.setUint8(offset + i, string.charCodeAt(i));\n    }\n};\n\n/**\n * Makes the TTS API call and returns an Audio URL.\n */\nconst ttsApiCall = async (text, setErrorMessage) => {\n    if (!text) return null;\n\n    try {\n        const payload = {\n            contents: [{ parts: [{ text: text }] }],\n            generationConfig: {\n                responseModalities: [\"AUDIO\"],\n                speechConfig: {\n                    voiceConfig: {\n                        // Using a clear, friendly voice\n                        prebuiltVoiceConfig: { voiceName: \"Achird\" } \n                    }\n                }\n            }\n        };\n\n        const response = await fetch(TTS_API_ENDPOINT, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(payload)\n        });\n\n        if (!response.ok) {\n            throw new Error(`TTS API failed with status ${response.status}`);\n        }\n\n        const result = await response.json();\n        const part = result?.candidates?.[0]?.content?.parts?.[0];\n        const audioData = part?.inlineData?.data;\n        const mimeType = part?.inlineData?.mimeType;\n\n        if (audioData && mimeType && mimeType.startsWith(\"audio/L16\")) {\n            // Extract sample rate from mimeType, e.g., audio/L16;rate=24000\n            const rateMatch = mimeType.match(/rate=(\\d+)/);\n            const sampleRate = rateMatch ? parseInt(rateMatch[1], 10) : 24000; \n\n            const pcmData = base64ToArrayBuffer(audioData);\n            const pcm16 = new Int16Array(pcmData);\n            const wavBlob = pcmToWav(pcm16, sampleRate);\n            return URL.createObjectURL(wavBlob);\n        } else {\n            setErrorMessage(\"TTS Error: Could not generate valid audio data.\");\n            return null;\n        }\n\n    } catch (error) {\n        console.error(\"TTS Fetch Error:\", error);\n        setErrorMessage(`TTS Generation failed: ${error.message}`);\n        return null;\n    }\n};\n\n\n// 4. Speech Recognition (STT) Utility\nlet recognition = null;\nconst setupRecognition = (onResult) => {\n    // Check for browser compatibility (webkitSpeechRecognition is the most common implementation)\n    if ('webkitSpeechRecognition' in window) {\n        // We must use `window.webkitSpeechRecognition` as standard `SpeechRecognition` might not be available\n        recognition = new window.webkitSpeechRecognition(); \n        recognition.continuous = false;\n        recognition.interimResults = false;\n        recognition.lang = 'en-US';\n\n        recognition.onresult = (event) => {\n            const transcript = event.results[0][0].transcript;\n            onResult(transcript);\n        };\n\n        recognition.onerror = (event) => {\n            console.error('Speech recognition error:', event.error);\n        };\n\n        recognition.onend = () => {\n            console.log('Speech recognition ended.');\n            setIsListening(false); // Make sure to update state on end/error\n        };\n\n        return true;\n    }\n    return false;\n};\n\n\n// 5. Common Collection Paths\nconst SESSIONS_COLLECTION_PATH = `/artifacts/${appId}/users`;\nconst MESSAGES_COLLECTION_PATH = (userId, sessionId) => \n    `/artifacts/${appId}/users/${userId}/sessions/${sessionId}/messages`;\n\n\n// --- UI Components (Defined locally for single-file mandate) ---\n\nconst Sidebar = React.memo(({ sessions, currentSessionId, switchSession, createNewSession, deleteSession, userId }) => {\n    return (\n        <div className=\"w-full md:w-64 bg-gray-50 border-r border-gray-200 p-4 flex flex-col transition-all duration-300\">\n            <h2 className=\"text-xl font-bold text-gray-800 mb-4 flex items-center justify-between\">\n                Conversations\n                <button\n                    onClick={createNewSession}\n                    className=\"p-2 bg-green-500 text-white rounded-full hover:bg-green-600 transition duration-150 shadow-md\"\n                    title=\"New Chat\"\n                >\n                    +\n                </button>\n            </h2>\n\n            <div className=\"flex-1 overflow-y-auto space-y-2\">\n                {sessions.map((session) => (\n                    <div\n                        key={session.id}\n                        className={`flex items-center justify-between p-3 rounded-lg cursor-pointer transition duration-150 ${session.id === currentSessionId ? 'bg-green-100 text-green-700 font-semibold' : 'bg-white text-gray-700 hover:bg-gray-100'}`}\n                        onClick={() => switchSession(session.id)}\n                    >\n                        <span className=\"truncate flex-1\">{session.name || \"New Chat\"}</span>\n                        <button\n                            onClick={(e) => { e.stopPropagation(); deleteSession(session.id); }}\n                            className=\"text-red-500 p-1 hover:text-red-700 rounded-full transition duration-150 ml-2\"\n                            title=\"Delete Chat\"\n                        >\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                                <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 100 2v6a1 1 0 100-2V8z\" clipRule=\"evenodd\" />\n                            </svg>\n                        </button>\n                    </div>\n                ))}\n            </div>\n            <div className=\"mt-4 pt-4 border-t border-gray-200 text-sm text-gray-500\">\n                User ID: <span className=\"font-mono text-xs\">{userId ? `${userId.substring(0, 8)}...` : \"N/A\"}</span>\n            </div>\n        </div>\n    );\n});\n\n\n// --- Main App Component ---\n\nexport default function App() {\n    // --- Firebase State ---\n    const [db, setDb] = useState(null);\n    const [auth, setAuth] = useState(null);\n    const [userId, setUserId] = useState(null);\n    const [isAuthReady, setIsAuthReady] = useState(false);\n    const [sessions, setSessions] = useState([]);\n    const [currentSessionId, setCurrentSessionId] = useState(null);\n\n    // --- Chat State ---\n    const [messages, setMessages] = useState([]);\n    const [input, setInput] = useState(\"\");\n    const [isTyping, setIsTyping] = useState(false);\n    const [errorMessage, setErrorMessage] = useState(null);\n    const messageEndRef = useRef(null);\n    const [isSidebarOpen, setIsSidebarOpen] = useState(window.innerWidth >= 768); // Open by default on desktop\n\n    // --- TTS/STT State ---\n    const [canSpeak, setCanSpeak] = useState(false);\n    const [isListening, setIsListening] = useState(false);\n    const [lastBotMessage, setLastBotMessage] = useState(null);\n    const recognitionRef = useRef(null); // Ref for speech recognition instance\n\n    // --- Effects ---\n\n    // 1. Initialize Firebase and Authentication\n    useEffect(() => {\n        if (firebaseConfig) {\n            try {\n                const app = initializeApp(firebaseConfig);\n                const firestore = getFirestore(app);\n                const authentication = getAuth(app);\n\n                // Enable debug logging for better development visibility\n                setLogLevel('debug'); \n                setDb(firestore);\n                setAuth(authentication);\n\n                const unsubscribeAuth = onAuthStateChanged(authentication, async (user) => {\n                    if (!user) {\n                        console.log(\"No user signed in. Attempting sign-in...\");\n                        try {\n                            // If custom token is available, use it; otherwise, sign in anonymously\n                            if (initialAuthToken) {\n                                await signInWithCustomToken(authentication, initialAuthToken);\n                            } else {\n                                await signInAnonymously(authentication);\n                            }\n                        } catch (e) {\n                            console.error(\"Firebase Auth Error:\", e);\n                            setErrorMessage(\"Failed to authenticate with Firebase.\");\n                        }\n                    }\n                    // Auth state has stabilized, user is set (anonymous or custom token)\n                    setUserId(authentication.currentUser?.uid || crypto.randomUUID());\n                    setIsAuthReady(true);\n                });\n\n                return () => unsubscribeAuth();\n            } catch (e) {\n                console.error(\"Firebase Init Error:\", e);\n                setErrorMessage(\"Failed to initialize Firebase services.\");\n            }\n        }\n    }, [firebaseConfig, initialAuthToken]);\n\n\n    // 2. Setup Sessions Listener\n    useEffect(() => {\n        if (!isAuthReady || !db || !userId) return;\n\n        const userSessionsRef = collection(db, SESSIONS_COLLECTION_PATH, userId, 'sessions');\n        const q = query(userSessionsRef, orderBy('createdAt', 'desc'));\n\n        const unsubscribe = onSnapshot(q, (snapshot) => {\n            const loadedSessions = snapshot.docs.map(doc => ({\n                id: doc.id,\n                ...doc.data()\n            }));\n\n            setSessions(loadedSessions);\n\n            // If no sessions exist, create a new one automatically\n            if (loadedSessions.length === 0) {\n                // Use a timeout to ensure state updates happen after listener setup\n                setTimeout(() => createSession(userId), 0);\n            } else if (!currentSessionId || !loadedSessions.find(s => s.id === currentSessionId)) {\n                // Set to the most recent session if current one is invalid or deleted\n                setCurrentSessionId(loadedSessions[0].id);\n            }\n        }, (error) => {\n            console.error(\"Firestore Sessions Error:\", error);\n            setErrorMessage(\"Failed to fetch chat sessions.\");\n        });\n\n        return () => unsubscribe();\n    }, [isAuthReady, db, userId, currentSessionId]); // Dependency on currentSessionId is required to re-evaluate logic when it changes\n\n    \n    // 3. Setup Messages Listener (Current Session)\n    useEffect(() => {\n        if (!isAuthReady || !db || !userId || !currentSessionId) {\n            setMessages([]); // Clear messages if no session is selected\n            return;\n        }\n\n        const messagesRef = collection(db, MESSAGES_COLLECTION_PATH(userId, currentSessionId));\n        // Query last 50 messages, ordered by time\n        const q = query(messagesRef, orderBy('createdAt', 'asc'), limit(50));\n\n        const unsubscribe = onSnapshot(q, (snapshot) => {\n            const loadedMessages = snapshot.docs.map(doc => {\n                const data = doc.data();\n                return {\n                    id: doc.id,\n                    sender: data.sender,\n                    text: data.text,\n                    // Handle Firestore Timestamp conversion\n                    createdAt: data.createdAt?.toDate ? data.createdAt.toDate() : new Date(),\n                };\n            });\n            setMessages(loadedMessages);\n\n            // Track the last bot message for the TTS button\n            const lastBot = loadedMessages.slice().reverse().find(msg => msg.sender === 'bot');\n            setLastBotMessage(lastBot);\n\n        }, (error) => {\n            console.error(\"Firestore Messages Error:\", error);\n            setErrorMessage(\"Failed to fetch chat messages.\");\n        });\n\n        return () => unsubscribe();\n    }, [isAuthReady, db, userId, currentSessionId]);\n\n\n    // 4. Scroll to bottom on new messages/typing\n    useEffect(() => {\n        messageEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    }, [messages, isTyping]);\n\n\n    // 5. Check for TTS/STT capability and setup STT\n    useEffect(() => {\n        if ('speechSynthesis' in window && 'webkitSpeechRecognition' in window) {\n            setCanSpeak(true);\n        }\n\n        // Setup the recognition object\n        if ('webkitSpeechRecognition' in window) {\n            const recognitionInstance = new window.webkitSpeechRecognition();\n            recognitionInstance.continuous = false;\n            recognitionInstance.interimResults = false;\n            recognitionInstance.lang = 'en-US';\n            \n            recognitionInstance.onend = () => setIsListening(false);\n            recognitionInstance.onerror = (event) => {\n                console.error('Speech recognition error:', event.error);\n                setErrorMessage(`Speech recognition error: ${event.error}`);\n                setIsListening(false);\n            };\n\n            recognitionRef.current = recognitionInstance;\n        }\n\n        // Cleanup on unmount\n        return () => {\n            if (recognitionRef.current) {\n                recognitionRef.current.stop();\n                recognitionRef.current = null;\n            }\n        };\n    }, []);\n\n    // --- Firebase Actions ---\n\n    const switchSession = useCallback((sessionId) => {\n        setCurrentSessionId(sessionId);\n        if (window.innerWidth < 768) {\n            setIsSidebarOpen(false); // Close sidebar on mobile after selection\n        }\n    }, []);\n\n    const createSession = useCallback(async () => {\n        if (!db || !userId) return;\n\n        try {\n            const userSessionsRef = collection(db, SESSIONS_COLLECTION_PATH, userId, 'sessions');\n            const newDocRef = doc(userSessionsRef);\n            \n            // Generate a placeholder name\n            const placeholderName = `Chat ${sessions.length + 1}`; \n\n            await setDoc(newDocRef, {\n                name: placeholderName,\n                createdAt: serverTimestamp(),\n            });\n\n            setCurrentSessionId(newDocRef.id);\n            if (window.innerWidth < 768) {\n                setIsSidebarOpen(false); // Close sidebar on mobile\n            }\n        } catch (e) {\n            console.error(\"Error creating new session:\", e);\n            setErrorMessage(\"Failed to create a new session.\");\n        }\n    }, [db, userId, sessions]);\n\n    const deleteSession = async (sessionId) => {\n        if (!db || !userId) return;\n\n        // Using a custom modal/confirmation dialog is recommended, but using window.confirm\n        // temporarily for simplicity in this single file.\n        if (!window.confirm(\"Are you sure you want to delete this chat session and all its messages?\")) {\n            return;\n        }\n\n        try {\n            const sessionDocRef = doc(db, SESSIONS_COLLECTION_PATH, userId, 'sessions', sessionId);\n            const messagesRef = collection(db, MESSAGES_COLLECTION_PATH(userId, sessionId));\n            \n            const batch = writeBatch(db);\n\n            // 1. Delete all messages within the session (this requires finding them first)\n            const messageDocs = await getDocs(messagesRef);\n            messageDocs.forEach(msgDoc => {\n                batch.delete(msgDoc.ref);\n            });\n            \n            // 2. Delete the session document itself\n            batch.delete(sessionDocRef);\n\n            await batch.commit();\n\n            // After deletion, find a new session to switch to or create a new one\n            if (currentSessionId === sessionId) {\n                const remainingSessions = sessions.filter(s => s.id !== sessionId);\n                if (remainingSessions.length > 0) {\n                    setCurrentSessionId(remainingSessions[0].id);\n                } else {\n                    setCurrentSessionId(null);\n                    // Use a slight delay to ensure the listener picks up the deletion before creation\n                    setTimeout(() => createSession(), 100); \n                }\n            }\n        } catch (e) {\n            console.error(\"Error deleting session:\", e);\n            setErrorMessage(\"Failed to delete the chat session.\");\n        }\n    };\n    \n    // --- TTS/STT Handlers ---\n\n    const handleSpeak = useCallback(async (text) => {\n        if (!canSpeak || !text) return;\n\n        // Clear previous error message\n        setErrorMessage(null);\n\n        const audioUrl = await ttsApiCall(text, setErrorMessage);\n        if (audioUrl) {\n            const audio = new Audio(audioUrl);\n            audio.play();\n        }\n    }, [canSpeak]);\n\n    const handleSend = useCallback(async (transcript = null) => {\n        const textToSend = (transcript || input).trim();\n        if (isTyping || !textToSend || !currentSessionId) return;\n\n        setErrorMessage(null);\n        setIsTyping(true);\n        setInput(\"\");\n\n        // 1. Save user message immediately\n        await saveMessage(\"user\", textToSend);\n\n        // 2. Stream and accumulate bot response\n        let accumulatedBotText = \"\";\n        // Use the current messages state to construct history for the AI\n        const historyForAI = messages.map(msg => ({ sender: msg.sender, text: msg.text })); \n        const stream = askAIStream(textToSend, historyForAI);\n\n        // Create a temporary message placeholder for streaming\n        const tempBotId = uuidv4();\n        setMessages(prev => [...prev, { id: tempBotId, sender: \"bot\", text: \"\" }]);\n\n        for await (const chunk of stream) {\n            accumulatedBotText += chunk;\n\n            // Update the temporary message with the streamed content\n            setMessages(prev => \n                prev.map(msg => \n                    msg.id === tempBotId ? { ...msg, text: accumulatedBotText } : msg\n                )\n            );\n\n            // Break if the stream returned an error\n            if (accumulatedBotText.includes(\"ERROR:\")) break;\n        }\n\n        setIsTyping(false);\n\n        // 3. Persist the final bot message (and remove the temporary one)\n        if (!accumulatedBotText.includes(\"ERROR:\")) {\n            // Find the session document reference\n            const sessionDocRef = doc(db, SESSIONS_COLLECTION_PATH, userId, 'sessions', currentSessionId);\n\n            // Update the session name with the first question if it's the first message\n            // Note: This check relies on the *local* messages array before the final message is saved.\n            if (messages.length === 0) {\n                const sessionName = textToSend.substring(0, 30) + (textToSend.length > 30 ? '...' : '');\n                await setDoc(sessionDocRef, { name: sessionName }, { merge: true });\n            }\n            \n            // Save final bot message\n            await saveMessage(\"bot\", accumulatedBotText);\n\n            // The Firestore onSnapshot listener will handle the final state update, \n            // removing the need to manually delete the temporary message here.\n            \n        } else {\n             // If error, keep the error message in the local state but do not persist it to Firestore\n             // The error message is already rendered via the streaming loop.\n        }\n\n    }, [input, isTyping, currentSessionId, db, userId, messages]);\n\n\n    const startListening = useCallback(() => {\n        if (isTyping || !recognitionRef.current) return;\n        \n        setErrorMessage(null);\n        \n        const recognitionInstance = recognitionRef.current;\n        \n        recognitionInstance.onresult = (event) => {\n            const transcript = event.results[0][0].transcript;\n            setInput(transcript);\n            recognitionInstance.stop(); // Manually stop after getting result\n            handleSend(transcript); // Auto-send the transcribed text\n        };\n\n        try {\n            recognitionInstance.start();\n            setIsListening(true);\n        } catch (e) {\n            // Error code 11 is typically \"already started\"\n            if (e.name !== 'InvalidStateError') { \n                console.error(\"STT Start Error:\", e);\n                setErrorMessage(\"Speech recognition failed to start. Browser support required.\");\n                setIsListening(false);\n            }\n        }\n    }, [isTyping, handleSend]);\n\n\n    // --- Chat Logic ---\n\n    const saveMessage = async (sender, text) => {\n        if (!db || !userId || !currentSessionId || !text) return;\n\n        try {\n            const messagesRef = collection(db, MESSAGES_COLLECTION_PATH(userId, currentSessionId));\n            await addDoc(messagesRef, {\n                sender: sender,\n                text: text,\n                createdAt: serverTimestamp(),\n            });\n        } catch (e) {\n            console.error(\"Error saving message:\", e);\n            setErrorMessage(\"Failed to save message to database.\");\n        }\n    };\n\n\n    // --- Render Logic ---\n\n    if (!isAuthReady) {\n        return (\n            <div className=\"flex justify-center items-center min-h-screen text-gray-600 bg-gray-100\">\n                <div className=\"p-6 bg-white rounded-xl shadow-lg\">\n                    <p>Loading application and authenticating...</p>\n                </div>\n            </div>\n        );\n    }\n    \n    // Header component\n    const Header = () => (\n        <div className=\"p-4 bg-green-600 text-white shadow-md flex items-center justify-between\">\n            <button \n                className=\"md:hidden p-1 rounded-md hover:bg-green-700 transition\"\n                onClick={() => setIsSidebarOpen(!isSidebarOpen)}\n                title=\"Toggle Sidebar\"\n            >\n                {/* Hamburger Icon */}\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16m-7 6h7\" />\n                </svg>\n            </button>\n            <h1 className=\"text-xl font-bold flex-1 text-center md:text-left\">\n                Mene AI Chatbot\n            </h1>\n            <span className=\"hidden md:block text-sm opacity-80 bg-green-700 px-3 py-1 rounded-full\">\n                Session: {sessions.find(s => s.id === currentSessionId)?.name || \"New Chat\"}\n            </span>\n            <div className=\"hidden md:block text-xs font-mono opacity-60 ml-4\">\n                User ID: {userId.substring(0, 8)}...\n            </div>\n        </div>\n    );\n\n    // Main Chat Content\n    const chatContent = (\n        <div className=\"flex-1 flex flex-col min-w-0 bg-white\">\n            <Header />\n\n            {/* Error Message Display */}\n            {errorMessage && (\n                <div className=\"p-3 bg-red-100 text-red-700 text-sm text-center font-medium border-l-4 border-red-500\">\n                    {errorMessage}\n                </div>\n            )}\n\n            {/* Message Area */}\n            <div className=\"flex-1 p-4 space-y-4 overflow-y-auto custom-scrollbar\">\n                {messages.map((msg) => (\n                    <div \n                        key={msg.id} \n                        className={`flex ${msg.sender === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n                    >\n                        <div\n                            // Tailwind classes for speech bubbles\n                            className={`max-w-xs md:max-w-md lg:max-w-lg p-3 rounded-xl shadow-md text-sm ${\n                                msg.sender === \"user\"\n                                    ? \"bg-blue-500 text-white rounded-br-none\"\n                                    : \"bg-gray-200 text-gray-800 rounded-tl-none\"\n                            }`}\n                            onClick={msg.sender === \"bot\" && canSpeak ? () => handleSpeak(msg.text) : null}\n                            style={msg.sender === \"bot\" && canSpeak ? {cursor: 'pointer'} : {}}\n                            title={msg.sender === \"bot\" && canSpeak ? \"Click to hear this message\" : null}\n                        >\n                            {msg.text}\n                        </div>\n                    </div>\n                ))}\n\n                {isTyping && (\n                    <div className=\"flex justify-start\">\n                        <div className=\"max-w-xs p-3 rounded-xl bg-gray-100 text-gray-500 italic text-sm shadow-sm\">\n                            Mene is generating...\n                        </div>\n                    </div>\n                )}\n\n                <div ref={messageEndRef} />\n            </div>\n\n            {/* Input Area */}\n            <div className=\"p-3 border-t border-gray-200 flex items-center space-x-2 bg-gray-50\">\n                {/* STT Button */}\n                <button \n                    className={`p-3 rounded-full transition duration-150 shadow-md ${\n                        isListening \n                            ? 'bg-red-500 text-white animate-pulse' \n                            : 'bg-gray-300 text-gray-700 hover:bg-gray-400'\n                    }`}\n                    onClick={startListening}\n                    disabled={isTyping}\n                    title={isListening ? \"Listening...\" : \"Start voice input (STT)\"}\n                >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path fillRule=\"evenodd\" d=\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4z\" clipRule=\"evenodd\" />\n                        <path d=\"M5.5 9.5a.5.5 0 011 0v4a.5.5 0 01-1 0v-4zM13.5 9.5a.5.5 0 011 0v4a.5.5 0 01-1 0v-4z\" />\n                        <path fillRule=\"evenodd\" d=\"M10 18a.75.75 0 01-.75-.75V15a.75.75 0 011.5 0v2.25A.75.75 0 0110 18zm6.5-6.5a.5.5 0 01-1 0v-4a.5.5 0 011 0v4zM3.5 11.5a.5.5 0 011 0v-4a.5.5 0 01-1 0v4z\" clipRule=\"evenodd\" />\n                        <path fillRule=\"evenodd\" d=\"M5 9.75a.75.75 0 01.75-.75h8.5a.75.75 0 010 1.5H5.75A.75.75 0 015 9.75z\" clipRule=\"evenodd\" />\n                        <path d=\"M15 11a1 1 0 011 1v2a4 4 0 01-8 0v-2a1 1 0 011-1h6z\" />\n                    </svg>\n                </button>\n\n                {/* Text Input */}\n                <input\n                    type=\"text\"\n                    value={input}\n                    onChange={(e) => setInput(e.target.value)}\n                    onKeyDown={(e) => e.key === \"Enter\" && handleSend()}\n                    placeholder=\"Ask Mene anything...\"\n                    disabled={isTyping}\n                    className=\"flex-1 p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150\"\n                />\n                \n                {/* TTS Button */}\n                <button \n                    className={`p-3 rounded-full transition duration-150 shadow-md ${\n                        canSpeak && !isTyping && lastBotMessage\n                            ? 'bg-green-500 text-white hover:bg-green-600'\n                            : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                    }`}\n                    onClick={() => handleSpeak(lastBotMessage?.text)}\n                    disabled={isTyping || !canSpeak || !lastBotMessage}\n                    title=\"Read last bot message aloud (TTS)\"\n                >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path fillRule=\"evenodd\" d=\"M9.383 3.003c.125-.466.52-.803.955-.803h.305c.435 0 .83.337.955.803l.36 1.353a1.5 1.5 0 001.037.989l.254.053c1.685.356 2.5 1.776 2.5 3.328v2.96c0 1.552-.815 2.972-2.5 3.328l-.254.053a1.5 1.5 0 00-1.037.989l-.36 1.353c-.125.466-.52.803-.955.803h-.305c-.435 0-.83-.337-.955-.803l-.36-1.353a1.5 1.5 0 00-1.037-.989l-.254-.053c-1.685-.356-2.5-1.776-2.5-3.328v-2.96c0-1.552.815-2.972 2.5-3.328l.254-.053a1.5 1.5 0 001.037-.989l.36-1.353zM10 7a1 1 0 100 2 1 1 0 000-2zm0 4a1 1 0 100 2 1 1 0 000-2z\" clipRule=\"evenodd\" />\n                    </svg>\n                </button>\n\n                {/* Send Button */}\n                <button \n                    className={`p-3 rounded-full transition duration-150 shadow-md ${\n                        isTyping || !input.trim()\n                            ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                            : 'bg-green-500 text-white hover:bg-green-600'\n                    }`}\n                    onClick={() => handleSend()} \n                    disabled={isTyping || !input.trim()}\n                    title=\"Send Message\"\n                >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path d=\"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l4.47-1.405 6.447 3.376a1 1 0 00.999 0l6.447-3.376 4.47 1.405a1 1 0 001.169-1.409l-7-14z\" />\n                    </svg>\n                </button>\n            </div>\n        </div>\n    );\n\n    // Final Application Layout (Desktop/Mobile Responsive)\n    return (\n        <div className=\"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-0 md:p-4 font-inter\">\n            <style jsx=\"true\">{`\n                /* Custom scrollbar for message area */\n                .custom-scrollbar::-webkit-scrollbar {\n                    width: 8px;\n                }\n                .custom-scrollbar::-webkit-scrollbar-track {\n                    background: #f1f1f1;\n                }\n                .custom-scrollbar::-webkit-scrollbar-thumb {\n                    background: #ccc;\n                    border-radius: 10px;\n                }\n                .custom-scrollbar::-webkit-scrollbar-thumb:hover {\n                    background: #999;\n                }\n            `}</style>\n            \n            <div className=\"w-full h-screen md:w-full md:max-w-6xl md:h-[90vh] flex bg-white md:rounded-xl shadow-2xl overflow-hidden transition-all duration-300\">\n                \n                {/* Sidebar (Conversations Menu) */}\n                <div \n                    className={`fixed inset-0 z-40 md:static md:z-auto ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0 transition-transform duration-300 w-64 flex-shrink-0`}\n                >\n                    <Sidebar \n                        sessions={sessions}\n                        currentSessionId={currentSessionId}\n                        switchSession={switchSession}\n                        createNewSession={createSession}\n                        deleteSession={deleteSession}\n                        userId={userId}\n                    />\n                    {/* Overlay for mobile view */}\n                    {isSidebarOpen && window.innerWidth < 768 && (\n                        <div \n                            className=\"absolute inset-0 bg-black opacity-50 md:hidden z-30\" \n                            onClick={() => setIsSidebarOpen(false)}\n                        ></div>\n                    )}\n                </div>\n\n                {/* Main Chat Area */}\n                <div className=\"flex-1 flex flex-col min-w-0 z-10\">\n                    {chatContent}\n                </div>\n            </div>\n        </div>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}